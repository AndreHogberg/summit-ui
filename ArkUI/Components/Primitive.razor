@using Microsoft.AspNetCore.Components.Rendering
<DynamicComponent 
    Type="@GetElementType()" 
    Parameters="@FilteredAttributes" />

@code {
    [Parameter] public string As { get; set; } = "div";
    [Parameter(CaptureUnmatchedValues = true)] public IDictionary<string, object>? AdditionalAttributes { get; set; }
    [Parameter] public RenderFragment? ChildContent { get; set; }

    private Type GetElementType() => typeof(HtmlTag);

    private Dictionary<string, object> FilteredAttributes
    {
        get
        {
            var attrs = new Dictionary<string, object>(AdditionalAttributes ?? new Dictionary<string, object>())
            {
                { "TagName", As }
            };
            if (ChildContent is not null)
            {
                attrs["ChildContent"] = ChildContent;
            }
            return attrs;
        }
    }
    
    // Internal helper to render the actual tag
    private class HtmlTag : ComponentBase
    {
        [Parameter] public string TagName { get; set; } = "div";
        [Parameter] public RenderFragment? ChildContent { get; set; }
        [Parameter(CaptureUnmatchedValues = true)] public IDictionary<string, object>? Attributes { get; set; }

        protected override void BuildRenderTree(RenderTreeBuilder builder)
        {
            builder.OpenElement(0, TagName);
            builder.AddMultipleAttributes(1, Attributes);
            builder.AddContent(2, ChildContent);
            builder.CloseElement();
        }
    }
}