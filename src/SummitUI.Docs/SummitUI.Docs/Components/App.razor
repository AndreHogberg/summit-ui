<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <base href="/"/>
    <link rel="icon" type="image/svg+xml" href="/Logo.svg"/>
    <script>
        // Inline theme initialization to prevent flash of incorrect theme
        (function() {
            const theme = localStorage.getItem('summitui-theme');
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            const isDark = theme === 'dark' || (theme !== 'light' && prefersDark);
            
            if (theme === 'dark') {
                document.documentElement.classList.add('dark');
            } else if (theme === 'light') {
                document.documentElement.classList.add('light');
            }
            // If no theme set, system preference handles it via CSS media query
            
            // Disable the non-matching hljs theme stylesheet
            document.addEventListener('DOMContentLoaded', function() {
                const lightLink = document.getElementById('hljs-theme-light');
                const darkLink = document.getElementById('hljs-theme-dark');
                if (lightLink && darkLink) {
                    lightLink.disabled = isDark;
                    darkLink.disabled = !isDark;
                }
            });
        })();
    </script>
    <ResourcePreloader/>
    <link rel="stylesheet" href="@Assets["app.css"]"/>
    <link id="hljs-theme-light" rel="stylesheet" href="@Assets["hljs-a11y-light.min.css"]"/>
    <link id="hljs-theme-dark" rel="stylesheet" href="@Assets["hljs-a11y-dark.min.css"]"/>
    <ImportMap/>
    <HeadOutlet/>
</head>

<body>
<Routes/>
<script src="@Assets["_framework/blazor.web.js"]"></script>
<script src="@Assets["_content/SummitUI/summitui.js"]" type="module"></script>
<script src="@Assets["theme.min.js"]" type="module"></script>
<script src="@Assets["hljs.bundle.min.js"]"></script>
<script>
    // Initialize highlight.js with MutationObserver for Blazor compatibility
    function initHighlighting() {
        document.querySelectorAll('pre code:not(.hljs)').forEach((block) => {
            hljs.highlightElement(block);
        });
    }

    // Watch for dynamically added code blocks (Blazor renders after page load)
    const observer = new MutationObserver((mutations) => {
        for (const mutation of mutations) {
            for (const node of mutation.addedNodes) {
                if (node.nodeType === Node.ELEMENT_NODE) {
                    // Check if the node itself is a code block
                    if (node.matches?.('pre code:not(.hljs)')) {
                        hljs.highlightElement(node);
                    }
                    // Check for code blocks within the added node
                    node.querySelectorAll?.('pre code:not(.hljs)').forEach((block) => {
                        hljs.highlightElement(block);
                    });
                }
            }
        }
    });

    // Start observing when document is ready
    document.addEventListener('DOMContentLoaded', () => {
        initHighlighting();
        observer.observe(document.body, { childList: true, subtree: true });
    });

    // Also run after Blazor enhanced navigation
    Blazor.addEventListener('enhancedload', initHighlighting);
</script>
</body>

</html>