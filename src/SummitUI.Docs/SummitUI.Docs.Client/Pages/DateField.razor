@page "/docs/datefield"
@rendermode InteractiveWebAssembly
@layout DocsLayout
@using SummitUI

<PageTitle>SummitUI - Datefield</PageTitle>

<div class="flex flex-col gap-12">
    @* Header *@
    <div class="flex flex-col gap-4">
        <div>
            <SuBadge Variant="SuBadgeVariant.Outline">Component</SuBadge>
        </div>
        <SuHeading Level="SuHeadingLevel.H1" class="flex flex-row items-center gap-4">
            DateField
            <SuPromptButton ComponentName="DateField" />
        </SuHeading>
        <SuText Lead="true" Muted="true">
            A segmented date/time input component with culture-aware formatting and full keyboard navigation.
        </SuText>
    </div>

    @* Live Demo *@
    <SuSection Title="Demo">
        <SuCard>
            <div class="flex flex-col gap-6">
                <div class="flex flex-col gap-2">
                    <DateFieldRoot @bind-Value="selectedDate">
                        <DateFieldLabel class="text-sm font-medium text-su-foreground">Select a date</DateFieldLabel>
                        <DateFieldInput class="su-datefield-input" />
                    </DateFieldRoot>
                    <p class="text-xs text-su-muted-foreground">Selected: @(selectedDate?.ToString("yyyy-MM-dd") ?? "None")</p>
                </div>
                
                <div class="flex flex-col gap-2">
                    <DateFieldRoot @bind-DateTimeValue="selectedDateTime" Granularity="DateFieldGranularity.Minute">
                        <DateFieldLabel class="text-sm font-medium text-su-foreground">Date and time</DateFieldLabel>
                        <DateFieldInput class="su-datefield-input" />
                    </DateFieldRoot>
                    <p class="text-xs text-su-muted-foreground">Selected: @(selectedDateTime?.ToString("yyyy-MM-dd HH:mm") ?? "None")</p>
                </div>
            </div>
        </SuCard>
    </SuSection>

    @* Features *@
    <SuSection Title="Features">
        <ul class="grid gap-2 text-sm text-su-muted-foreground">
            <li class="flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-su-primary"><path d="M20 6 9 17l-5-5"/></svg>
                Segmented editing (each part is independently editable)
            </li>
            <li class="flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-su-primary"><path d="M20 6 9 17l-5-5"/></svg>
                Culture-aware date formatting
            </li>
            <li class="flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-su-primary"><path d="M20 6 9 17l-5-5"/></svg>
                Support for both DateOnly and DateTime types
            </li>
            <li class="flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-su-primary"><path d="M20 6 9 17l-5-5"/></svg>
                Configurable granularity (day, hour, minute, second)
            </li>
            <li class="flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-su-primary"><path d="M20 6 9 17l-5-5"/></svg>
                12-hour and 24-hour time formats
            </li>
            <li class="flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-su-primary"><path d="M20 6 9 17l-5-5"/></svg>
                Min/max validation and EditForm integration
            </li>
            <li class="flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-su-primary"><path d="M20 6 9 17l-5-5"/></svg>
                WCAG compliant with proper ARIA attributes
            </li>
        </ul>
    </SuSection>

    @* Installation *@
    <SuSection Title="Installation">
        <SuCodeBlock Code="dotnet add package SummitUI" Language="bash" />
    </SuSection>

    @* Anatomy *@
    <SuSection Title="Anatomy" Description="Import the components and structure them as follows:">
        <SuCodeBlock Code="@anatomyCode" Language="razor" />
    </SuSection>

    @* Sub-components *@
    <SuSection Title="Sub-components">
        <div class="grid gap-4 sm:grid-cols-2">
            <SuCard>
                <SuCardTitle>DateFieldRoot</SuCardTitle>
                <SuCardDescription class="mt-1">Root container managing date field state.</SuCardDescription>
            </SuCard>
            <SuCard>
                <SuCardTitle>DateFieldLabel</SuCardTitle>
                <SuCardDescription class="mt-1">Accessible label for the date field.</SuCardDescription>
            </SuCard>
            <SuCard>
                <SuCardTitle>DateFieldInput</SuCardTitle>
                <SuCardDescription class="mt-1">Container that renders date/time segments.</SuCardDescription>
            </SuCard>
            <SuCard>
                <SuCardTitle>DateFieldSegment</SuCardTitle>
                <SuCardDescription class="mt-1">Individual editable segment (auto-generated).</SuCardDescription>
            </SuCard>
        </div>
    </SuSection>

    @* API Reference *@
    <SuSection Title="API Reference">
        <div class="flex flex-col gap-12">
            <div class="flex flex-col gap-3">
                <SuHeading Level="SuHeadingLevel.H3">DateFieldRoot</SuHeading>
                <SuTable>
                    <SuTableHeader>
                        <SuTableRow>
                            <SuTableHead>Property</SuTableHead>
                            <SuTableHead>Type</SuTableHead>
                            <SuTableHead>Default</SuTableHead>
                            <SuTableHead>Description</SuTableHead>
                        </SuTableRow>
                    </SuTableHeader>
                    <SuTableBody>
                        @foreach (var prop in dateFieldRootProperties)
                        {
                            <SuTableRow>
                                <SuTableCell class="font-mono text-su-primary font-medium">
                                    @prop.Name
                                    @if (prop.Required)
                                    {
                                        <SuBadge Variant="SuBadgeVariant.Destructive" Size="SuSize.Small" class="ml-2">required</SuBadge>
                                    }
                                </SuTableCell>
                                <SuTableCell class="font-mono text-su-muted-foreground text-sm">@prop.Type</SuTableCell>
                                <SuTableCell class="font-mono text-su-muted-foreground text-sm">@(prop.Default ?? "-")</SuTableCell>
                                <SuTableCell class="text-su-muted-foreground">@(prop.Description ?? "-")</SuTableCell>
                            </SuTableRow>
                        }
                    </SuTableBody>
                </SuTable>
            </div>
        </div>
    </SuSection>

    @* Enums *@
    <SuSection Title="Enums">
        <div class="flex flex-col gap-8">
            <div class="flex flex-col gap-4">
                <SuHeading Level="SuHeadingLevel.H3">DateFieldGranularity</SuHeading>
                <SuCodeBlock Code="@granularityEnumCode" Language="csharp" />
            </div>

            <div class="flex flex-col gap-4">
                <SuHeading Level="SuHeadingLevel.H3">HourCycle</SuHeading>
                <SuCodeBlock Code="@hourCycleEnumCode" Language="csharp" />
            </div>
        </div>
    </SuSection>

    @* Examples *@
    <SuSection Title="Examples">
        <div class="flex flex-col gap-8">
            <div class="flex flex-col gap-4">
                <SuHeading Level="SuHeadingLevel.H3">Basic DateOnly Field</SuHeading>
                <SuCodeBlock Code="@basicExampleCode" Language="razor" />
            </div>

            <div class="flex flex-col gap-4">
                <SuHeading Level="SuHeadingLevel.H3">DateTime with Time</SuHeading>
                <SuText Size="SuTextSize.Small" Muted="true">Use Granularity to show time segments.</SuText>
                <SuCodeBlock Code="@dateTimeExampleCode" Language="razor" />
            </div>

            <div class="flex flex-col gap-4">
                <SuHeading Level="SuHeadingLevel.H3">Min/Max Validation</SuHeading>
                <SuText Size="SuTextSize.Small" Muted="true">Constrain the date range.</SuText>
                <SuCodeBlock Code="@minMaxExampleCode" Language="razor" />
            </div>

            <div class="flex flex-col gap-4">
                <SuHeading Level="SuHeadingLevel.H3">EditForm Integration</SuHeading>
                <SuText Size="SuTextSize.Small" Muted="true">Use with Blazor forms and validation.</SuText>
                <SuCodeBlock Code="@formExampleCode" Language="razor" />
            </div>
        </div>
    </SuSection>

    @* Styling *@
    <SuSection Title="Styling">
        <div class="flex flex-col gap-12">
            <div class="flex flex-col gap-3">
                <SuHeading Level="SuHeadingLevel.H3">Data Attributes</SuHeading>
                <SuTable>
                    <SuTableHeader>
                        <SuTableRow>
                            <SuTableHead>Attribute</SuTableHead>
                            <SuTableHead>Values</SuTableHead>
                            <SuTableHead>Description</SuTableHead>
                        </SuTableRow>
                    </SuTableHeader>
                    <SuTableBody>
                        @foreach (var attr in dataAttributes)
                        {
                            <SuTableRow>
                                <SuTableCell class="font-mono text-su-primary font-medium">@attr.Name</SuTableCell>
                                <SuTableCell class="font-mono text-su-muted-foreground text-sm">@attr.Type</SuTableCell>
                                <SuTableCell class="text-su-muted-foreground">@attr.Description</SuTableCell>
                            </SuTableRow>
                        }
                    </SuTableBody>
                </SuTable>
            </div>

            <div class="flex flex-col gap-4">
                <SuHeading Level="SuHeadingLevel.H3">CSS Example</SuHeading>
                <SuCodeBlock Code="@cssExampleCode" Language="css" />
            </div>
        </div>
    </SuSection>

    @* Accessibility *@
    <SuSection Title="Accessibility">
        <div class="flex flex-col gap-12">
            <div class="flex flex-col gap-3">
                <SuHeading Level="SuHeadingLevel.H3">Keyboard Navigation</SuHeading>
                <SuTable>
                    <SuTableHeader>
                        <SuTableRow>
                            <SuTableHead>Key</SuTableHead>
                            <SuTableHead>Action</SuTableHead>
                        </SuTableRow>
                    </SuTableHeader>
                    <SuTableBody>
                        @foreach (var nav in keyboardNavigation)
                        {
                            <SuTableRow>
                                <SuTableCell class="font-medium text-su-foreground">@nav.Name</SuTableCell>
                                <SuTableCell class="text-su-muted-foreground">@nav.Description</SuTableCell>
                            </SuTableRow>
                        }
                    </SuTableBody>
                </SuTable>
            </div>

            <div class="flex flex-col gap-4">
                <SuHeading Level="SuHeadingLevel.H3">ARIA Attributes</SuHeading>
                <ul class="grid gap-2 text-sm text-su-muted-foreground">
                    <li class="flex items-start gap-2">
                        <span class="text-su-foreground font-medium shrink-0">Root:</span>
                        <span>Has <code>role="group"</code> with <code>aria-labelledby</code> pointing to label</span>
                    </li>
                    <li class="flex items-start gap-2">
                        <span class="text-su-foreground font-medium shrink-0">Segments:</span>
                        <span>Each has <code>role="spinbutton"</code> with <code>aria-valuemin</code>, <code>aria-valuemax</code>, <code>aria-valuenow</code></span>
                    </li>
                    <li class="flex items-start gap-2">
                        <span class="text-su-foreground font-medium shrink-0">Literals:</span>
                        <span>Separator segments have <code>aria-hidden="true"</code></span>
                    </li>
                </ul>
            </div>
        </div>
    </SuSection>
</div>

<style>
    /* Demo DateField Styles */
    .su-datefield-input {
        display: inline-flex;
        align-items: center;
        gap: 0;
        padding: 0.5rem 0.75rem;
        background: rgb(var(--su-background));
        border: 1px solid rgb(var(--su-border));
        border-radius: 0.375rem;
        font-size: 0.875rem;
        font-family: inherit;
        margin-top: 0.5rem;
    }
    
    .su-datefield-input:focus-within {
        border-color: rgb(var(--su-primary));
        box-shadow: 0 0 0 2px rgb(var(--su-primary) / 0.2);
    }
</style>

@code {
    private DateOnly? selectedDate = DateOnly.FromDateTime(DateTime.Today);
    private DateTime? selectedDateTime = DateTime.Now;

    private List<SuApiProperty> dateFieldRootProperties = new()
    {
        new() { Name = "Value", Type = "DateOnly?", Default = "null", Description = "Bound DateOnly value" },
        new() { Name = "ValueChanged", Type = "EventCallback<DateOnly?>", Description = "DateOnly value change callback" },
        new() { Name = "DateTimeValue", Type = "DateTime?", Default = "null", Description = "Bound DateTime value" },
        new() { Name = "DateTimeValueChanged", Type = "EventCallback<DateTime?>", Description = "DateTime value change callback" },
        new() { Name = "Granularity", Type = "DateFieldGranularity", Default = "Day", Description = "Controls which segments are displayed" },
        new() { Name = "HourCycle", Type = "HourCycle", Default = "Auto", Description = "12-hour or 24-hour time format" },
        new() { Name = "Locale", Type = "CultureInfo?", Default = "Current culture", Description = "Culture for date formatting" },
        new() { Name = "DatePattern", Type = "string?", Default = "null", Description = "Custom date format pattern" },
        new() { Name = "MinValue", Type = "DateOnly?", Default = "null", Description = "Minimum allowed DateOnly value" },
        new() { Name = "MaxValue", Type = "DateOnly?", Default = "null", Description = "Maximum allowed DateOnly value" },
        new() { Name = "Disabled", Type = "bool", Default = "false", Description = "Disables the entire date field" },
        new() { Name = "ReadOnly", Type = "bool", Default = "false", Description = "Makes the field read-only" },
        new() { Name = "Invalid", Type = "bool", Default = "false", Description = "Indicates validation error state" },
        new() { Name = "Required", Type = "bool", Default = "false", Description = "Marks the field as required" }
    };

    private List<SuApiProperty> dataAttributes = new()
    {
        new() { Name = "data-disabled", Type = "Present when disabled", Description = "Date field is disabled" },
        new() { Name = "data-readonly", Type = "Present when read-only", Description = "Date field is read-only" },
        new() { Name = "data-invalid", Type = "Present when invalid", Description = "Validation error state" },
        new() { Name = "data-placeholder", Type = "Present when no value", Description = "Showing placeholder" },
        new() { Name = "data-segment", Type = "Segment type", Description = "Identifies segment type for styling" }
    };

    private List<SuApiProperty> keyboardNavigation = new()
    {
        new() { Name = "ArrowUp", Description = "Increment the focused segment value", Type = "" },
        new() { Name = "ArrowDown", Description = "Decrement the focused segment value", Type = "" },
        new() { Name = "ArrowLeft", Description = "Move focus to previous segment", Type = "" },
        new() { Name = "ArrowRight", Description = "Move focus to next segment", Type = "" },
        new() { Name = "Tab", Description = "Move focus to next segment (or next element)", Type = "" },
        new() { Name = "0-9", Description = "Type numeric value directly into segment", Type = "" },
        new() { Name = "Backspace / Delete", Description = "Clear the value (sets to null)", Type = "" },
        new() { Name = "A / P", Description = "Toggle AM/PM on DayPeriod segment", Type = "" }
    };

    private const string anatomyCode = @"<DateFieldRoot @bind-Value=""date"">
    <DateFieldLabel>Select a date</DateFieldLabel>
    <DateFieldInput class=""su-datefield-input"" />
</DateFieldRoot>";

    private const string granularityEnumCode = @"public enum DateFieldGranularity
{
    Day,    // Show only date segments (Year, Month, Day)
    Hour,   // Show date and hour segments
    Minute, // Show date, hour, and minute segments
    Second  // Show date, hour, minute, and second segments
}";

    private const string hourCycleEnumCode = @"public enum HourCycle
{
    Auto, // Use the locale's default hour cycle
    H12,  // 12-hour cycle with AM/PM (1-12)
    H23,  // 24-hour cycle (0-23)
    H24,  // 24-hour cycle (1-24)
    H11   // 12-hour cycle (0-11)
}";

    private const string basicExampleCode = @"@code {
    private DateOnly? selectedDate = DateOnly.FromDateTime(DateTime.Today);
}

<DateFieldRoot @bind-Value=""selectedDate"">
    <DateFieldLabel>Select a date</DateFieldLabel>
    <DateFieldInput class=""su-datefield-input"" />
</DateFieldRoot>

<p>Selected: @(selectedDate?.ToString(""yyyy-MM-dd"") ?? ""None"")</p>";

    private const string dateTimeExampleCode = @"@code {
    private DateTime? selectedDateTime = DateTime.Now;
}

<DateFieldRoot @bind-DateTimeValue=""selectedDateTime"" 
               Granularity=""DateFieldGranularity.Minute"">
    <DateFieldLabel>Select date and time</DateFieldLabel>
    <DateFieldInput class=""su-datefield-input"" />
</DateFieldRoot>

<p>Selected: @(selectedDateTime?.ToString(""yyyy-MM-dd HH:mm"") ?? ""None"")</p>";

    private const string minMaxExampleCode = @"@code {
    private DateOnly? date = DateOnly.FromDateTime(DateTime.Today);
    private DateOnly minDate = new DateOnly(2025, 1, 1);
    private DateOnly maxDate = new DateOnly(2025, 12, 31);
}

<DateFieldRoot @bind-Value=""date"" 
               MinValue=""@minDate"" 
               MaxValue=""@maxDate"">
    <DateFieldLabel>Select a date (Jan - Dec 2025)</DateFieldLabel>
    <DateFieldInput class=""su-datefield-input"" />
</DateFieldRoot>";

    private const string formExampleCode = @"<EditForm EditContext=""editContext"" OnSubmit=""HandleSubmit"">
    <DataAnnotationsValidator />
    
    <DateFieldRoot @bind-Value=""model.BirthDate""
                   Name=""birthDate""
                   Required=""true""
                   Invalid=""@(submitted && model.BirthDate == null)"">
        <DateFieldLabel>Birth Date (Required)</DateFieldLabel>
        <DateFieldInput class=""su-datefield-input"" />
    </DateFieldRoot>
    <ValidationMessage For=""@(() => model.BirthDate)"" />

    <button type=""submit"">Submit</button>
</EditForm>";

    private const string cssExampleCode = @"/* Input container */
.su-datefield-input {
    display: inline-flex;
    align-items: center;
    padding: 0.5rem 0.75rem;
    background: rgb(var(--su-background));
    border: 1px solid rgb(var(--su-border));
    border-radius: 6px;
}

.su-datefield-input:focus-within {
    border-color: rgb(var(--su-primary));
    box-shadow: 0 0 0 3px rgb(var(--su-primary) / 0.25);
}

[data-disabled] .su-datefield-input {
    background: rgb(var(--su-muted));
    cursor: not-allowed;
}

[data-invalid] .su-datefield-input {
    border-color: rgb(var(--su-destructive));
}

/* Segment styling */
[data-segment]:not([data-segment=""literal""]) {
    padding: 0.125rem 0.25rem;
    border-radius: 4px;
    min-width: 1.5em;
    text-align: center;
}

[data-segment]:not([data-segment=""literal""]):focus {
    background: rgb(var(--su-accent));
    color: rgb(var(--su-accent-foreground));
    outline: none;
}

[data-segment=""literal""] {
    color: rgb(var(--su-muted-foreground));
}

[data-segment][data-placeholder] {
    color: rgb(var(--su-muted-foreground) / 0.5);
}";
}
