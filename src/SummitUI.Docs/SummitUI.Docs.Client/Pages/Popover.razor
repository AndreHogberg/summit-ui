@page "/docs/popover"
@layout DocsLayout
@rendermode InteractiveWebAssembly
<PageTitle>SummitUI - Popover</PageTitle>

<div class="flex flex-col gap-12">
    @* Header *@
    <div class="flex flex-col gap-4">
        <div>
            <SuBadge Variant="SuBadgeVariant.Outline">Component</SuBadge>
        </div>
        <SuHeading Level="SuHeadingLevel.H1" class="flex flex-row items-center gap-4">
            Popover
            <SuPromptButton ComponentName="Popover" Url="/docs/popover" />
        </SuHeading>
        <SuText Lead="true" Muted="true">
            A floating content panel that appears next to a trigger element, commonly used for tooltips, dropdowns, and informational overlays.
        </SuText>
    </div>

    @* Live Demo *@
    <SuSection Title="Demo">
        <SuCard>
            <PopoverRoot>
                <PopoverTrigger class="demo-popover-trigger">
                    Click me
                </PopoverTrigger>
                <PopoverPortal>
                    <PopoverContent class="demo-popover-content data-[state=open]:animate-in data-[state=open]:fade-in-0 data-[state=open]:zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 duration-150" SideOffset="8">
                        <div class="flex flex-col gap-3">
                            <h3 class="font-medium text-su-foreground">Popover Title</h3>
                            <p class="text-sm text-su-muted-foreground">This is a simple popover with some content. Click outside or press Escape to close.</p>
                            <PopoverClose class="demo-popover-close">Close</PopoverClose>
                        </div>
                    </PopoverContent>
                </PopoverPortal>
            </PopoverRoot>
        </SuCard>
    </SuSection>

    @* Features *@
    <SuSection Title="Features">
        <ul class="grid gap-2 text-sm text-su-muted-foreground">
            <li class="flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-su-primary"><path d="M20 6 9 17l-5-5"/></svg>
                Flexible positioning with collision detection
            </li>
            <li class="flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-su-primary"><path d="M20 6 9 17l-5-5"/></svg>
                Optional overlay backdrop
            </li>
            <li class="flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-su-primary"><path d="M20 6 9 17l-5-5"/></svg>
                Focus trapping support
            </li>
            <li class="flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-su-primary"><path d="M20 6 9 17l-5-5"/></svg>
                Close button component
            </li>
            <li class="flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-su-primary"><path d="M20 6 9 17l-5-5"/></svg>
                Controlled and uncontrolled modes
            </li>
            <li class="flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-su-primary"><path d="M20 6 9 17l-5-5"/></svg>
                WCAG compliant with proper ARIA attributes
            </li>
        </ul>
    </SuSection>

    @* Installation *@
    <SuSection Title="Installation">
        <SuCodeBlock Code="dotnet add package SummitUI" Language="bash" />
    </SuSection>

    @* Anatomy *@
    <SuSection Title="Anatomy" Description="Import the components and structure them as follows:">
        <SuCodeBlock Code="@anatomyCode" Language="razor" />
    </SuSection>

    @* Sub-components *@
    <SuSection Title="Sub-components">
        <div class="grid gap-4 sm:grid-cols-2 lg:grid-cols-3">
            <SuCard>
                <SuCardTitle>PopoverRoot</SuCardTitle>
                <SuCardDescription class="mt-1">Root container managing popover state.</SuCardDescription>
            </SuCard>
            <SuCard>
                <SuCardTitle>PopoverTrigger</SuCardTitle>
                <SuCardDescription class="mt-1">Button that toggles the popover.</SuCardDescription>
            </SuCard>
            <SuCard>
                <SuCardTitle>PopoverPortal</SuCardTitle>
                <SuCardDescription class="mt-1">Renders content in fixed-position container.</SuCardDescription>
            </SuCard>
            <SuCard>
                <SuCardTitle>PopoverContent</SuCardTitle>
                <SuCardDescription class="mt-1">Floating content panel with positioning.</SuCardDescription>
            </SuCard>
            <SuCard>
                <SuCardTitle>PopoverOverlay</SuCardTitle>
                <SuCardDescription class="mt-1">Optional backdrop overlay.</SuCardDescription>
            </SuCard>
            <SuCard>
                <SuCardTitle>PopoverClose</SuCardTitle>
                <SuCardDescription class="mt-1">Close button within popover.</SuCardDescription>
            </SuCard>
        </div>
    </SuSection>

    @* API Reference *@
    <SuSection Title="API Reference">
        <div class="flex flex-col gap-12">
            @foreach (var table in new[] { 
                (Title: "PopoverRoot", Props: popoverRootProperties), 
                (Title: "PopoverContent", Props: popoverContentProperties)
            })
            {
                <div class="flex flex-col gap-3">
                    <SuHeading Level="SuHeadingLevel.H3">@table.Title</SuHeading>
                    <SuTable>
                        <SuTableHeader>
                            <SuTableRow>
                                <SuTableHead>Property</SuTableHead>
                                <SuTableHead>Type</SuTableHead>
                                <SuTableHead>Default</SuTableHead>
                                <SuTableHead>Description</SuTableHead>
                            </SuTableRow>
                        </SuTableHeader>
                        <SuTableBody>
                            @foreach (var prop in table.Props)
                            {
                                <SuTableRow>
                                    <SuTableCell class="font-mono text-su-primary font-medium">
                                        @prop.Name
                                        @if (prop.Required)
                                        {
                                            <SuBadge Variant="SuBadgeVariant.Destructive" Size="SuSize.Small" class="ml-2">required</SuBadge>
                                        }
                                    </SuTableCell>
                                    <SuTableCell class="font-mono text-su-muted-foreground text-sm">@prop.Type</SuTableCell>
                                    <SuTableCell class="font-mono text-su-muted-foreground text-sm">@(prop.Default ?? "-")</SuTableCell>
                                    <SuTableCell class="text-su-muted-foreground">@(prop.Description ?? "-")</SuTableCell>
                                </SuTableRow>
                            }
                        </SuTableBody>
                    </SuTable>
                </div>
            }
        </div>
    </SuSection>

    @* Examples *@
    <SuSection Title="Examples">
        <div class="flex flex-col gap-8">
            <div class="flex flex-col gap-4">
                <SuHeading Level="SuHeadingLevel.H3">Basic Popover</SuHeading>
                <SuCodeBlock Code="@basicExampleCode" Language="razor" />
            </div>

            <div class="flex flex-col gap-4">
                <SuHeading Level="SuHeadingLevel.H3">With Overlay</SuHeading>
                <SuText Size="SuTextSize.Small" Muted="true">Add a backdrop overlay for modal-like behavior.</SuText>
                <SuCodeBlock Code="@overlayExampleCode" Language="razor" />
            </div>

            <div class="flex flex-col gap-4">
                <SuHeading Level="SuHeadingLevel.H3">Different Positions</SuHeading>
                <SuText Size="SuTextSize.Small" Muted="true">Position the popover on different sides.</SuText>
                <SuCodeBlock Code="@positionsExampleCode" Language="razor" />
            </div>

            <div class="flex flex-col gap-4">
                <SuHeading Level="SuHeadingLevel.H3">Controlled Mode</SuHeading>
                <SuText Size="SuTextSize.Small" Muted="true">Control the open state externally.</SuText>
                <SuCodeBlock Code="@controlledExampleCode" Language="razor" />
            </div>
        </div>
    </SuSection>

    @* Styling *@
    <SuSection Title="Styling">
        <div class="flex flex-col gap-12">
            <div class="flex flex-col gap-3">
                <SuHeading Level="SuHeadingLevel.H3">Data Attributes</SuHeading>
                <SuTable>
                    <SuTableHeader>
                        <SuTableRow>
                            <SuTableHead>Attribute</SuTableHead>
                            <SuTableHead>Values</SuTableHead>
                            <SuTableHead>Description</SuTableHead>
                        </SuTableRow>
                    </SuTableHeader>
                    <SuTableBody>
                        @foreach (var attr in dataAttributes)
                        {
                            <SuTableRow>
                                <SuTableCell class="font-mono text-su-primary font-medium">@attr.Name</SuTableCell>
                                <SuTableCell class="font-mono text-su-muted-foreground text-sm">@attr.Type</SuTableCell>
                                <SuTableCell class="text-su-muted-foreground">@attr.Description</SuTableCell>
                            </SuTableRow>
                        }
                    </SuTableBody>
                </SuTable>
            </div>

            <div class="flex flex-col gap-4">
                <SuHeading Level="SuHeadingLevel.H3">CSS Example</SuHeading>
                <SuCodeBlock Code="@cssExampleCode" Language="css" />
            </div>
        </div>
    </SuSection>

    @* Accessibility *@
    <SuSection Title="Accessibility">
        <div class="flex flex-col gap-12">
            <div class="flex flex-col gap-3">
                <SuHeading Level="SuHeadingLevel.H3">Keyboard Navigation</SuHeading>
                <SuTable>
                    <SuTableHeader>
                        <SuTableRow>
                            <SuTableHead>Key</SuTableHead>
                            <SuTableHead>Action</SuTableHead>
                        </SuTableRow>
                    </SuTableHeader>
                    <SuTableBody>
                        @foreach (var nav in keyboardNavigation)
                        {
                            <SuTableRow>
                                <SuTableCell class="font-medium text-su-foreground">@nav.Name</SuTableCell>
                                <SuTableCell class="text-su-muted-foreground">@nav.Description</SuTableCell>
                            </SuTableRow>
                        }
                    </SuTableBody>
                </SuTable>
            </div>

            <div class="flex flex-col gap-4">
                <SuHeading Level="SuHeadingLevel.H3">ARIA Attributes</SuHeading>
                <ul class="grid gap-2 text-sm text-su-muted-foreground">
                    <li class="flex items-start gap-2">
                        <span class="text-su-foreground font-medium shrink-0">Trigger:</span>
                        <span>Has <code>aria-haspopup="dialog"</code> and <code>aria-expanded</code></span>
                    </li>
                    <li class="flex items-start gap-2">
                        <span class="text-su-foreground font-medium shrink-0">Content:</span>
                        <span>Linked to trigger via <code>aria-controls</code></span>
                    </li>
                    <li class="flex items-start gap-2">
                        <span class="text-su-foreground font-medium shrink-0">Close:</span>
                        <span>Has <code>aria-label</code> for screen readers</span>
                    </li>
                </ul>
            </div>

            <div class="flex flex-col gap-4">
                <SuHeading Level="SuHeadingLevel.H3">Focus Management</SuHeading>
                <ul class="grid gap-2 text-sm text-su-muted-foreground">
                    <li>When opened, focus moves to the first focusable element in the content</li>
                    <li>When closed, focus returns to the trigger</li>
                    <li>Optional focus trapping keeps focus within the popover</li>
                </ul>
            </div>
        </div>
    </SuSection>
</div>

<style>
    /* Demo Popover Styles */
    .demo-popover-trigger {
        display: inline-flex;
        align-items: center;
        padding: 0.5rem 1rem;
        background: rgb(var(--su-primary));
        color: rgb(var(--su-primary-foreground));
        border: none;
        border-radius: 0.375rem;
        font-size: 0.875rem;
        font-weight: 500;
        cursor: pointer;
        transition: opacity 0.15s;
    }
    
    .demo-popover-trigger:hover {
        opacity: 0.9;
    }
    
    .demo-popover-content {
        width: 18rem;
        background: rgb(var(--su-card));
        border: 1px solid rgb(var(--su-border));
        border-radius: 0.5rem;
        box-shadow: 0 4px 12px rgb(var(--su-foreground) / 0.15);
        padding: 1rem;
        z-index: 50;
    }
    
    .demo-popover-close {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        padding: 0.375rem 0.75rem;
        background: rgb(var(--su-muted));
        border: none;
        border-radius: 0.25rem;
        font-size: 0.75rem;
        font-weight: 500;
        cursor: pointer;
        color: rgb(var(--su-foreground));
    }
    
    .demo-popover-close:hover {
        background: rgb(var(--su-muted-foreground) / 0.1);
    }
</style>

@code {
    private List<SuApiProperty> popoverRootProperties = new()
    {
        new() { Name = "Open", Type = "bool?", Default = "null", Description = "Controlled open state" },
        new() { Name = "DefaultOpen", Type = "bool", Default = "false", Description = "Default open state (uncontrolled)" },
        new() { Name = "OpenChanged", Type = "EventCallback<bool>", Description = "Open state change callback" },
        new() { Name = "OnOpen", Type = "EventCallback", Description = "Callback when popover opens" },
        new() { Name = "OnClose", Type = "EventCallback", Description = "Callback when popover closes" },
        new() { Name = "Modal", Type = "bool", Default = "false", Description = "Whether to trap focus" }
    };

    private List<SuApiProperty> popoverContentProperties = new()
    {
        new() { Name = "Side", Type = "Side", Default = "Bottom", Description = "Placement side" },
        new() { Name = "SideOffset", Type = "int", Default = "0", Description = "Offset from trigger (px)" },
        new() { Name = "Align", Type = "Align", Default = "Center", Description = "Alignment along side axis" },
        new() { Name = "AvoidCollisions", Type = "bool", Default = "true", Description = "Avoid viewport boundaries" },
        new() { Name = "TrapFocus", Type = "bool", Default = "false", Description = "Whether to trap focus" },
        new() { Name = "EscapeKeyBehavior", Type = "EscapeKeyBehavior", Default = "Close", Description = "Escape key behavior" },
        new() { Name = "OutsideClickBehavior", Type = "OutsideClickBehavior", Default = "Close", Description = "Outside click behavior" }
    };

    private List<SuApiProperty> dataAttributes = new()
    {
        new() { Name = "data-state", Type = "\"open\" | \"closed\"", Description = "Popover open state" },
        new() { Name = "data-side", Type = "\"top\" | \"right\" | \"bottom\" | \"left\"", Description = "Current placement side" },
        new() { Name = "data-align", Type = "\"start\" | \"center\" | \"end\"", Description = "Current alignment" }
    };

    private List<SuApiProperty> keyboardNavigation = new()
    {
        new() { Name = "Enter / Space", Description = "Toggle popover (on trigger)", Type = "" },
        new() { Name = "Escape", Description = "Close popover", Type = "" },
        new() { Name = "Tab", Description = "Move focus within popover (when focus trapped)", Type = "" }
    };

    private const string anatomyCode = @"<PopoverRoot>
    <PopoverTrigger class=""su-popover-trigger"">Open</PopoverTrigger>
    <PopoverPortal>
        <PopoverContent class=""su-popover-content"">
            <p>Popover content</p>
            <PopoverClose class=""su-popover-close"">Close</PopoverClose>
        </PopoverContent>
    </PopoverPortal>
</PopoverRoot>";

    private const string basicExampleCode = @"<PopoverRoot>
    <PopoverTrigger class=""su-popover-trigger"">Click me</PopoverTrigger>
    <PopoverPortal>
        <PopoverContent class=""su-popover-content"" SideOffset=""8"">
            <h3 class=""su-popover-title"">Basic Popover</h3>
            <p class=""su-popover-description"">This is a simple popover with some content.</p>
            <PopoverClose class=""su-popover-close"">Close</PopoverClose>
        </PopoverContent>
    </PopoverPortal>
</PopoverRoot>";

    private const string overlayExampleCode = @"<PopoverRoot>
    <PopoverTrigger class=""su-popover-trigger"">Open with Overlay</PopoverTrigger>
    <PopoverPortal>
        <PopoverOverlay class=""su-popover-overlay"" />
        <PopoverContent class=""su-popover-content"" SideOffset=""8"">
            <h3 class=""su-popover-title"">Modal-like Popover</h3>
            <p class=""su-popover-description"">Click the overlay or press Escape to close.</p>
            <PopoverClose class=""su-popover-close"">Done</PopoverClose>
        </PopoverContent>
    </PopoverPortal>
</PopoverRoot>";

    private const string positionsExampleCode = @"@* Bottom (default) *@
<PopoverContent class=""su-popover-content"" Side=""Side.Bottom"" SideOffset=""8"">
    Content appears below
</PopoverContent>

@* Top *@
<PopoverContent class=""su-popover-content"" Side=""Side.Top"" SideOffset=""8"">
    Content appears above
</PopoverContent>

@* Left *@
<PopoverContent class=""su-popover-content"" Side=""Side.Left"" SideOffset=""8"">
    Content appears to the left
</PopoverContent>

@* Right *@
<PopoverContent class=""su-popover-content"" Side=""Side.Right"" SideOffset=""8"">
    Content appears to the right
</PopoverContent>";

    private const string controlledExampleCode = @"@code {
    private bool isOpen = false;
}

<PopoverRoot Open=""@isOpen"" OpenChanged=""@(v => isOpen = v)"">
    <PopoverTrigger class=""su-popover-trigger"">
        @(isOpen ? ""Close"" : ""Open"")
    </PopoverTrigger>
    <PopoverPortal>
        <PopoverContent class=""su-popover-content"" SideOffset=""8"">
            <p>Controlled popover content</p>
        </PopoverContent>
    </PopoverPortal>
</PopoverRoot>

<button class=""su-button"" @onclick=""@(() => isOpen = !isOpen)"">
    Toggle Externally
</button>";

    private const string cssExampleCode = @"/* Trigger */
.su-popover-trigger {
    display: inline-flex;
    align-items: center;
    padding: 8px 16px;
    background: rgb(var(--su-primary));
    color: rgb(var(--su-primary-foreground));
    border: none;
    border-radius: 4px;
    cursor: pointer;
}

.su-popover-trigger[data-state=""open""] {
    opacity: 0.9;
}

/* Overlay */
.su-popover-overlay {
    position: fixed;
    inset: 0;
    background: rgb(var(--su-foreground) / 0.4);
}

/* Content */
.su-popover-content {
    background: rgb(var(--su-card));
    border: 1px solid rgb(var(--su-border));
    border-radius: 8px;
    box-shadow: 0 4px 20px rgb(var(--su-foreground) / 0.15);
    min-width: 280px;
    max-width: 400px;
    padding: 16px;
}

.su-popover-content[data-state=""closed""] {
    display: none;
}";
}
