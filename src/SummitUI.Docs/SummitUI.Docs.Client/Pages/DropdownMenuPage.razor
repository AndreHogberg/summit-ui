@page "/docs/dropdown-menu"
@rendermode InteractiveWebAssembly
@layout DocsLayout
@using SummitUI

<PageTitle>SummitUI - Dropdown Menu</PageTitle>

<div class="flex flex-col gap-12">
    @* Header *@
    <div class="flex flex-col gap-4">
        <div>
            <SuBadge Variant="SuBadgeVariant.Outline">Component</SuBadge>
        </div>
        <SuHeading Level="SuHeadingLevel.H1" class="flex flex-row items-center gap-4">
            DropdownMenu
            <SuPromptButton ComponentName="DropdownMenu" Url="/docs/dropdown-menu" />
        </SuHeading>
        <SuText Lead="true" Muted="true">
            A floating menu component with support for items, checkbox items, radio groups, and nested groups.
        </SuText>
    </div>

    @* Live Demo *@
    <SuSection Title="Demo">
        <SuCard>
            <DropdownMenuRoot>
                <DropdownMenuTrigger class="demo-dropdown-trigger">
                    <span>Options</span>
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="m6 9 6 6 6-6"/>
                    </svg>
                </DropdownMenuTrigger>
                <DropdownMenuPortal>
                    <DropdownMenuContent class="demo-dropdown-content data-[state=open]:animate-in data-[state=open]:fade-in-0 data-[state=open]:zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 duration-150" SideOffset="4">
                        <DropdownMenuItem TextValue="New File" class="demo-dropdown-item" OnSelect="@(() => selectedAction = "New File")">
                            New File
                        </DropdownMenuItem>
                        <DropdownMenuItem TextValue="Open File" class="demo-dropdown-item" OnSelect="@(() => selectedAction = "Open File")">
                            Open File
                        </DropdownMenuItem>
                        <DropdownMenuSeparator class="demo-dropdown-separator" />
                        <DropdownMenuItem TextValue="Save" class="demo-dropdown-item" OnSelect="@(() => selectedAction = "Save")">
                            Save
                        </DropdownMenuItem>
                        <DropdownMenuItem TextValue="New File" class="demo-dropdown-item" Disabled="true">
                            Export (Disabled)
                        </DropdownMenuItem>
                    </DropdownMenuContent>
                </DropdownMenuPortal>
            </DropdownMenuRoot>
            @if (!string.IsNullOrEmpty(selectedAction))
            {
                <SuText Size="SuTextSize.Small" Muted="true" class="mt-4">Last action: @selectedAction</SuText>
            }
        </SuCard>
    </SuSection>

    @* Features *@
    <SuSection Title="Features">
        <ul class="grid gap-2 text-sm text-su-muted-foreground">
            <li class="flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-su-primary"><path d="M20 6 9 17l-5-5"/></svg>
                Full keyboard navigation
            </li>
            <li class="flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-su-primary"><path d="M20 6 9 17l-5-5"/></svg>
                Checkbox and radio item support
            </li>
            <li class="flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-su-primary"><path d="M20 6 9 17l-5-5"/></svg>
                Grouped items with labels
            </li>
            <li class="flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-su-primary"><path d="M20 6 9 17l-5-5"/></svg>
                Flexible positioning with collision detection
            </li>
            <li class="flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-su-primary"><path d="M20 6 9 17l-5-5"/></svg>
                Focus trapping in modal mode
            </li>
            <li class="flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-su-primary"><path d="M20 6 9 17l-5-5"/></svg>
                WCAG compliant with proper ARIA attributes
            </li>
        </ul>
    </SuSection>

    @* Installation *@
    <SuSection Title="Installation">
        <SuCodeBlock Code="dotnet add package SummitUI" Language="bash" />
    </SuSection>

    @* Anatomy *@
    <SuSection Title="Anatomy" Description="Import the components and structure them as follows:">
        <SuCodeBlock Code="@anatomyCode" Language="razor" />
    </SuSection>

    @* Sub-components *@
    <SuSection Title="Sub-components">
        <div class="grid gap-4 sm:grid-cols-2 lg:grid-cols-3">
            @foreach (var sub in subComponents)
            {
                <SuCard>
                    <SuCardTitle>@sub.Name</SuCardTitle>
                    <SuCardDescription class="mt-1">@sub.Description</SuCardDescription>
                </SuCard>
            }
        </div>
    </SuSection>

    @* API Reference *@
    <SuSection Title="API Reference">
        <div class="flex flex-col gap-12">
            @foreach (var table in new[] { 
                (Title: "DropdownMenuRoot", Props: rootProps), 
                (Title: "DropdownMenuContent", Props: contentProps),
                (Title: "DropdownMenuItem", Props: itemProps)
            })
            {
                <div class="flex flex-col gap-3">
                    <SuHeading Level="SuHeadingLevel.H3">@table.Title</SuHeading>
                    <SuTable>
                        <SuTableHeader>
                            <SuTableRow>
                                <SuTableHead>Property</SuTableHead>
                                <SuTableHead>Type</SuTableHead>
                                <SuTableHead>Default</SuTableHead>
                                <SuTableHead>Description</SuTableHead>
                            </SuTableRow>
                        </SuTableHeader>
                        <SuTableBody>
                            @foreach (var prop in table.Props)
                            {
                                <SuTableRow>
                                    <SuTableCell class="font-mono text-su-primary font-medium">
                                        @prop.Name
                                        @if (prop.Required)
                                        {
                                            <SuBadge Variant="SuBadgeVariant.Destructive" Size="SuSize.Small" class="ml-2">required</SuBadge>
                                        }
                                    </SuTableCell>
                                    <SuTableCell class="font-mono text-su-muted-foreground text-sm">@prop.Type</SuTableCell>
                                    <SuTableCell class="font-mono text-su-muted-foreground text-sm">@(prop.Default ?? "-")</SuTableCell>
                                    <SuTableCell class="text-su-muted-foreground">@(prop.Description ?? "-")</SuTableCell>
                                </SuTableRow>
                            }
                        </SuTableBody>
                    </SuTable>
                </div>
            }
        </div>
    </SuSection>

    @* Examples *@
    <SuSection Title="Examples">
        <div class="flex flex-col gap-8">
            <div class="flex flex-col gap-4">
                <SuHeading Level="SuHeadingLevel.H3">Basic Menu</SuHeading>
                <SuCodeBlock Code="@basicExampleCode" Language="razor" />
            </div>

            <div class="flex flex-col gap-4">
                <SuHeading Level="SuHeadingLevel.H3">With Checkbox Items</SuHeading>
                <SuText Size="SuTextSize.Small" Muted="true">Toggle-able menu items.</SuText>
                <SuCodeBlock Code="@checkboxExampleCode" Language="razor" />
            </div>

            <div class="flex flex-col gap-4">
                <SuHeading Level="SuHeadingLevel.H3">With Radio Group</SuHeading>
                <SuText Size="SuTextSize.Small" Muted="true">Mutually exclusive options.</SuText>
                <SuCodeBlock Code="@radioExampleCode" Language="razor" />
            </div>

            <div class="flex flex-col gap-4">
                <SuHeading Level="SuHeadingLevel.H3">Grouped Items</SuHeading>
                <SuText Size="SuTextSize.Small" Muted="true">Organize items into labeled groups.</SuText>
                <SuCodeBlock Code="@groupedExampleCode" Language="razor" />
            </div>
        </div>
    </SuSection>

    @* Styling *@
    <SuSection Title="Styling">
        <div class="flex flex-col gap-12">
            <div class="flex flex-col gap-3">
                <SuHeading Level="SuHeadingLevel.H3">Data Attributes</SuHeading>
                <SuTable>
                    <SuTableHeader>
                        <SuTableRow>
                            <SuTableHead>Attribute</SuTableHead>
                            <SuTableHead>Values</SuTableHead>
                            <SuTableHead>Description</SuTableHead>
                        </SuTableRow>
                    </SuTableHeader>
                    <SuTableBody>
                        @foreach (var attr in dataAttributes)
                        {
                            <SuTableRow>
                                <SuTableCell class="font-mono text-su-primary font-medium">@attr.Name</SuTableCell>
                                <SuTableCell class="font-mono text-su-muted-foreground text-sm">@attr.Type</SuTableCell>
                                <SuTableCell class="text-su-muted-foreground">@attr.Description</SuTableCell>
                            </SuTableRow>
                        }
                    </SuTableBody>
                </SuTable>
            </div>

            <div class="flex flex-col gap-4">
                <SuHeading Level="SuHeadingLevel.H3">CSS Example</SuHeading>
                <SuCodeBlock Code="@cssExampleCode" Language="css" />
            </div>
        </div>
    </SuSection>

    @* Accessibility *@
    <SuSection Title="Accessibility">
        <div class="flex flex-col gap-12">
            <div class="flex flex-col gap-3">
                <SuHeading Level="SuHeadingLevel.H3">Keyboard Navigation</SuHeading>
                <SuTable>
                    <SuTableHeader>
                        <SuTableRow>
                            <SuTableHead>Key</SuTableHead>
                            <SuTableHead>Action</SuTableHead>
                        </SuTableRow>
                    </SuTableHeader>
                    <SuTableBody>
                        @foreach (var nav in keyboardNavigation)
                        {
                            <SuTableRow>
                                <SuTableCell class="font-medium text-su-foreground">@nav.Name</SuTableCell>
                                <SuTableCell class="text-su-muted-foreground">@nav.Description</SuTableCell>
                            </SuTableRow>
                        }
                    </SuTableBody>
                </SuTable>
            </div>

            <div class="flex flex-col gap-4">
                <SuHeading Level="SuHeadingLevel.H3">ARIA Attributes</SuHeading>
                <ul class="grid gap-2 text-sm text-su-muted-foreground">
                    <li class="flex items-start gap-2">
                        <span class="text-su-foreground font-medium shrink-0">Trigger:</span>
                        <span>Has <code>aria-haspopup="menu"</code> and <code>aria-expanded</code></span>
                    </li>
                    <li class="flex items-start gap-2">
                        <span class="text-su-foreground font-medium shrink-0">Content:</span>
                        <span>Has <code>role="menu"</code></span>
                    </li>
                    <li class="flex items-start gap-2">
                        <span class="text-su-foreground font-medium shrink-0">Items:</span>
                        <span>Have <code>role="menuitem"</code>, checkbox items have <code>role="menuitemcheckbox"</code></span>
                    </li>
                </ul>
            </div>
        </div>
    </SuSection>
</div>

<style>
    .demo-dropdown-trigger {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.5rem 1rem;
        background: rgb(var(--su-background));
        border: 1px solid rgb(var(--su-border));
        border-radius: 0.375rem;
        font-size: 0.875rem;
        font-weight: 500;
        cursor: pointer;
        color: rgb(var(--su-foreground));
        transition: all 0.15s;
    }
    
    .demo-dropdown-trigger:hover {
        background: rgb(var(--su-muted));
    }
    
    .demo-dropdown-trigger:focus-visible {
        outline: 2px solid rgb(var(--su-primary));
        outline-offset: 2px;
    }
    
    .demo-dropdown-trigger[data-state="open"] {
        background: rgb(var(--su-muted));
    }
    
    .demo-dropdown-content {
        min-width: 12rem;
        background: rgb(var(--su-card));
        border: 1px solid rgb(var(--su-border));
        border-radius: 0.5rem;
        box-shadow: 0 4px 12px rgb(var(--su-foreground) / 0.15);
        padding: 0.25rem;
        z-index: 50;
    }
    
    .demo-dropdown-item {
        display: flex;
        align-items: center;
        padding: 0.5rem 0.75rem;
        border-radius: 0.25rem;
        font-size: 0.875rem;
        cursor: pointer;
        color: rgb(var(--su-foreground));
        outline: none;
    }
    
    .demo-dropdown-item[data-highlighted] {
        background: rgb(var(--su-accent));
        color: rgb(var(--su-accent-foreground));
    }
    
    .demo-dropdown-item[data-disabled] {
        opacity: 0.5;
        cursor: not-allowed;
    }
    
    .demo-dropdown-separator {
        height: 1px;
        background: rgb(var(--su-border));
        margin: 0.25rem 0;
    }
</style>

@code {
    private string? selectedAction;

    private record SubComponent(string Name, string Description);

    private readonly List<SubComponent> subComponents = new()
    {
        new("DropdownMenuRoot", "Root container managing menu state."),
        new("DropdownMenuTrigger", "Button that toggles the menu."),
        new("DropdownMenuPortal", "Renders content at document body level."),
        new("DropdownMenuContent", "Floating content panel with positioning."),
        new("DropdownMenuItem", "Single selectable menu item."),
        new("DropdownMenuCheckboxItem", "Toggle-able checkbox menu item."),
        new("DropdownMenuRadioGroup", "Container for radio items."),
        new("DropdownMenuRadioItem", "Radio option within a group."),
        new("DropdownMenuSeparator", "Visual separator between items.")
    };

    private readonly List<SuApiProperty> rootProps = new()
    {
        new() { Name = "Open", Type = "bool?", Default = "null", Description = "Controlled open state" },
        new() { Name = "DefaultOpen", Type = "bool", Default = "false", Description = "Default open state (uncontrolled)" },
        new() { Name = "OpenChanged", Type = "EventCallback<bool>", Description = "Callback when open state changes" },
        new() { Name = "OnOpen", Type = "EventCallback", Description = "Callback when menu opens" },
        new() { Name = "OnClose", Type = "EventCallback", Description = "Callback when menu closes" },
        new() { Name = "Modal", Type = "bool", Default = "true", Description = "Whether to trap focus" }
    };

    private readonly List<SuApiProperty> contentProps = new()
    {
        new() { Name = "Side", Type = "Side", Default = "Bottom", Description = "Placement side" },
        new() { Name = "SideOffset", Type = "int", Default = "4", Description = "Offset from trigger (px)" },
        new() { Name = "Align", Type = "Align", Default = "Start", Description = "Alignment along side axis" },
        new() { Name = "AvoidCollisions", Type = "bool", Default = "true", Description = "Avoid viewport boundaries" },
        new() { Name = "Loop", Type = "bool", Default = "true", Description = "Loop keyboard navigation" }
    };

    private readonly List<SuApiProperty> itemProps = new()
    {
        new() { Name = "Disabled", Type = "bool", Default = "false", Description = "Disable item" },
        new() { Name = "OnSelect", Type = "EventCallback", Description = "Selection callback" }
    };

    private readonly List<SuApiProperty> dataAttributes = new()
    {
        new() { Name = "data-state", Type = "\"open\" | \"closed\"", Description = "Menu open state" },
        new() { Name = "data-highlighted", Type = "Present when focused", Description = "Item is keyboard-focused" },
        new() { Name = "data-disabled", Type = "Present when disabled", Description = "Item is disabled" }
    };

    private readonly List<SuApiProperty> keyboardNavigation = new()
    {
        new() { Name = "Enter / Space", Description = "Open menu or select item", Type = "" },
        new() { Name = "ArrowDown", Description = "Move focus to next item", Type = "" },
        new() { Name = "ArrowUp", Description = "Move focus to previous item", Type = "" },
        new() { Name = "Home", Description = "Move focus to first item", Type = "" },
        new() { Name = "End", Description = "Move focus to last item", Type = "" },
        new() { Name = "Escape", Description = "Close menu", Type = "" }
    };

    private const string anatomyCode = @"<DropdownMenuRoot>
    <DropdownMenuTrigger class=""su-dropdown-trigger"">Open Menu</DropdownMenuTrigger>
    <DropdownMenuPortal>
        <DropdownMenuContent class=""su-dropdown-content"">
            <DropdownMenuItem class=""su-dropdown-item"">Item 1</DropdownMenuItem>
            <DropdownMenuItem class=""su-dropdown-item"">Item 2</DropdownMenuItem>
            <DropdownMenuSeparator class=""su-dropdown-separator"" />
            <DropdownMenuItem class=""su-dropdown-item"">Item 3</DropdownMenuItem>
        </DropdownMenuContent>
    </DropdownMenuPortal>
</DropdownMenuRoot>";

    private const string basicExampleCode = @"<DropdownMenuRoot>
    <DropdownMenuTrigger class=""su-dropdown-trigger"">Options</DropdownMenuTrigger>
    <DropdownMenuPortal>
        <DropdownMenuContent class=""su-dropdown-content"" SideOffset=""4"">
            <DropdownMenuItem class=""su-dropdown-item"" OnSelect=""@(() => HandleAction(""new""))"">
                New File
            </DropdownMenuItem>
            <DropdownMenuItem class=""su-dropdown-item"" OnSelect=""@(() => HandleAction(""open""))"">
                Open File
            </DropdownMenuItem>
            <DropdownMenuSeparator class=""su-dropdown-separator"" />
            <DropdownMenuItem class=""su-dropdown-item"" OnSelect=""@(() => HandleAction(""save""))"">
                Save
            </DropdownMenuItem>
        </DropdownMenuContent>
    </DropdownMenuPortal>
</DropdownMenuRoot>";

    private const string checkboxExampleCode = @"@code {
    private bool showToolbar = true;
    private bool showSidebar = false;
}

<DropdownMenuRoot>
    <DropdownMenuTrigger class=""su-dropdown-trigger"">View</DropdownMenuTrigger>
    <DropdownMenuPortal>
        <DropdownMenuContent class=""su-dropdown-content"">
            <DropdownMenuCheckboxItem class=""su-dropdown-item"" @bind-Checked=""showToolbar"">
                @(context.Checked ? ""✓"" : """")
                <span>Show Toolbar</span>
            </DropdownMenuCheckboxItem>
            <DropdownMenuCheckboxItem class=""su-dropdown-item"" @bind-Checked=""showSidebar"">
                @(context.Checked ? ""✓"" : """")
                <span>Show Sidebar</span>
            </DropdownMenuCheckboxItem>
        </DropdownMenuContent>
    </DropdownMenuPortal>
</DropdownMenuRoot>";

    private const string radioExampleCode = @"@code {
    private string? selectedTheme = ""system"";
}

<DropdownMenuRoot>
    <DropdownMenuTrigger class=""su-dropdown-trigger"">Theme</DropdownMenuTrigger>
    <DropdownMenuPortal>
        <DropdownMenuContent class=""su-dropdown-content"">
            <DropdownMenuRadioGroup @bind-Value=""selectedTheme"" AriaLabel=""Theme"">
                <DropdownMenuRadioItem class=""su-dropdown-item"" Value=""light"">
                    @(context.IsSelected ? ""●"" : ""○"") Light
                </DropdownMenuRadioItem>
                <DropdownMenuRadioItem class=""su-dropdown-item"" Value=""dark"">
                    @(context.IsSelected ? ""●"" : ""○"") Dark
                </DropdownMenuRadioItem>
                <DropdownMenuRadioItem class=""su-dropdown-item"" Value=""system"">
                    @(context.IsSelected ? ""●"" : ""○"") System
                </DropdownMenuRadioItem>
            </DropdownMenuRadioGroup>
        </DropdownMenuContent>
    </DropdownMenuPortal>
</DropdownMenuRoot>";

    private const string groupedExampleCode = @"<DropdownMenuRoot>
    <DropdownMenuTrigger class=""su-dropdown-trigger"">Edit</DropdownMenuTrigger>
    <DropdownMenuPortal>
        <DropdownMenuContent class=""su-dropdown-content"">
            <DropdownMenuGroup>
                <DropdownMenuGroupLabel class=""su-dropdown-label"">Clipboard</DropdownMenuGroupLabel>
                <DropdownMenuItem class=""su-dropdown-item"">Cut</DropdownMenuItem>
                <DropdownMenuItem class=""su-dropdown-item"">Copy</DropdownMenuItem>
                <DropdownMenuItem class=""su-dropdown-item"">Paste</DropdownMenuItem>
            </DropdownMenuGroup>
            <DropdownMenuSeparator class=""su-dropdown-separator"" />
            <DropdownMenuGroup>
                <DropdownMenuGroupLabel class=""su-dropdown-label"">Selection</DropdownMenuGroupLabel>
                <DropdownMenuItem class=""su-dropdown-item"">Select All</DropdownMenuItem>
                <DropdownMenuItem class=""su-dropdown-item"">Deselect</DropdownMenuItem>
            </DropdownMenuGroup>
        </DropdownMenuContent>
    </DropdownMenuPortal>
</DropdownMenuRoot>";

    private const string cssExampleCode = @"/* Trigger */
.su-dropdown-trigger {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 8px 16px;
    background: rgb(var(--su-background));
    border: 1px solid rgb(var(--su-border));
    border-radius: 4px;
    cursor: pointer;
    color: rgb(var(--su-foreground));
}

.su-dropdown-trigger[data-state=""open""] {
    background: rgb(var(--su-muted));
}

/* Content */
.su-dropdown-content {
    min-width: 200px;
    background: rgb(var(--su-card));
    border: 1px solid rgb(var(--su-border));
    border-radius: 8px;
    box-shadow: 0 4px 12px rgb(var(--su-foreground) / 0.15);
    padding: 4px;
}

/* Item */
.su-dropdown-item {
    display: flex;
    align-items: center;
    padding: 8px 12px;
    border-radius: 4px;
    cursor: pointer;
    color: rgb(var(--su-foreground));
    outline: none;
}

.su-dropdown-item[data-highlighted] {
    background: rgb(var(--su-accent));
    color: rgb(var(--su-accent-foreground));
}

.su-dropdown-item[data-disabled] {
    opacity: 0.5;
    cursor: not-allowed;
}

/* Label */
.su-dropdown-label {
    padding: 8px 12px;
    font-size: 0.75rem;
    font-weight: 600;
    color: rgb(var(--su-muted-foreground));
}

/* Separator */
.su-dropdown-separator {
    height: 1px;
    background: rgb(var(--su-border));
    margin: 4px 0;
}";
}
