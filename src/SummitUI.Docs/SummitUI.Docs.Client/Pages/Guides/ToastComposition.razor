@page "/docs/guides/toast-composition"
@rendermode InteractiveWebAssembly
@layout DocsLayout

<PageTitle>SummitUI - Toast Composition</PageTitle>

<div class="flex flex-col gap-12">
    @* Header *@
    <div class="flex flex-col gap-4">
        <div class="flex items-center justify-between">
            <SuBadge Variant="SuBadgeVariant.Outline">Guide</SuBadge>
            <SuPromptButton ComponentName="Toast Composition" Url="/docs/guides/toast-composition" />
        </div>
        <SuHeading Level="SuHeadingLevel.H1">
            Toast Composition
        </SuHeading>
        <SuText Lead="true" Muted="true">
            Learn how to create a custom toast wrapper with semantic methods like ShowSuccess(), ShowError(), and more using SummitUI's generic toast queue.
        </SuText>
    </div>

    @* Introduction *@
    <SuSection>
        <SuText>
            SummitUI provides a generic <code class="text-su-foreground bg-su-muted px-1 py-0.5 rounded">IToastQueue&lt;TContent&gt;</code> 
            that you can compose into your own notification system. While you can use it directly with any content type,
            most applications benefit from creating a custom wrapper with semantic methods like
            <code class="text-su-foreground bg-su-muted px-1 py-0.5 rounded">ShowSuccess()</code>,
            <code class="text-su-foreground bg-su-muted px-1 py-0.5 rounded">ShowError()</code>, and
            <code class="text-su-foreground bg-su-muted px-1 py-0.5 rounded">ShowWarning()</code>.
        </SuText>
    </SuSection>

    @* Define Toast Content Type *@
    <SuSection Title="1. Define Your Toast Content Type">
        <SuText class="mb-6">
            First, create a record or class that holds all the data your toasts need.
        </SuText>

        <SuCard class="mb-6">
            <div class="bg-su-muted/30">
                <SuCodeBlock Code="@contentTypeCode" Language="csharp" />
            </div>
        </SuCard>
    </SuSection>

    @* Create Extension Methods *@
    <SuSection Title="2. Create Extension Methods">
        <SuText class="mb-6">
            Create extension methods on <code class="text-su-foreground bg-su-muted px-1 py-0.5 rounded">IToastQueue&lt;TContent&gt;</code>
            for semantic toast operations:
        </SuText>

        <div class="bg-su-muted/30 rounded-md border border-su-border overflow-hidden">
            <SuCodeBlock Code="@extensionMethodsCode" Language="csharp" />
        </div>
    </SuSection>

    @* Registration *@
    <SuSection Title="3. Register the Toast Queue">
        <SuText class="mb-6">
            Register your toast queue in <code class="text-su-foreground bg-su-muted px-1 py-0.5 rounded">Program.cs</code>:
        </SuText>

        <div class="bg-su-muted/30 rounded-md border border-su-border overflow-hidden">
            <SuCodeBlock Code="@registrationCode" Language="csharp" />
        </div>
    </SuSection>

    @* Creating Toast Component *@
    <SuSection Title="4. Create a Reusable Toast Component">
        <SuText class="mb-6">
            Create a toast component that renders your content type with consistent styling. 
            ToastRegion automatically portals to body to avoid CSS stacking context issues.
        </SuText>

        <div class="bg-su-muted/30 rounded-md border border-su-border overflow-hidden">
            <SuCodeBlock Code="@toastComponentCode" Language="razor" />
        </div>
    </SuSection>

    @* Layout Integration *@
    <SuSection Title="5. Add to Layout">
        <SuText class="mb-6">
            Add the toast component to your layout file to make toasts available throughout your application.
        </SuText>

        <div class="bg-su-muted/30 rounded-md border border-su-border overflow-hidden">
            <SuCodeBlock Code="@layoutCode" Language="razor" />
        </div>
    </SuSection>

    @* Usage Example *@
    <SuSection Title="6. Using Your Toast Extensions">
        <SuText class="mb-6">
            Now you can inject and use your semantic toast methods anywhere in your application.
        </SuText>

        <div class="bg-su-muted/30 rounded-md border border-su-border overflow-hidden mb-6">
            <SuCodeBlock Code="@usageCode" Language="razor" />
        </div>
    </SuSection>

    @* Custom Toast Styling *@
    <SuSection Title="Styling Toast Variants">
        <SuText class="mb-6">
            Use the <code class="text-su-foreground bg-su-muted px-1 py-0.5 rounded">data-variant</code> attribute
            to apply variant-specific styling via CSS or Tailwind classes.
        </SuText>

        <SuHeading Level="SuHeadingLevel.H3" class="mb-4">CSS Approach</SuHeading>
        <div class="bg-su-muted/30 rounded-md border border-su-border overflow-hidden mb-6">
            <SuCodeBlock Code="@cssVariantCode" Language="css" />
        </div>

        <SuHeading Level="SuHeadingLevel.H3" class="mb-4">Tailwind Approach</SuHeading>
        <SuText class="mb-6">
            Use Tailwind's <code class="text-su-foreground bg-su-muted px-1 py-0.5 rounded">data-[variant=*]:</code> selector.
        </SuText>
        <div class="bg-su-muted/30 rounded-md border border-su-border overflow-hidden">
            <SuCodeBlock Code="@tailwindVariantCode" Language="razor" />
        </div>
    </SuSection>

    @* Swipe to Dismiss *@
    <SuSection Title="Swipe to Dismiss">
        <SuText class="mb-6">
            Enable swipe gestures on touch devices. The Toast component tracks swipe state via data attributes 
            and CSS variables for smooth animations.
        </SuText>

        <div class="bg-su-muted/30 rounded-md border border-su-border overflow-hidden mb-6">
            <SuCodeBlock Code="@swipeCode" Language="razor" />
        </div>

        <SuText class="mb-6">
            Available swipe data attributes:
        </SuText>
        <ul class="list-disc ml-6 space-y-2 text-su-muted-foreground">
            <li><code class="text-su-foreground bg-su-muted px-1 py-0.5 rounded">data-swipe="start"</code> - Swipe gesture started</li>
            <li><code class="text-su-foreground bg-su-muted px-1 py-0.5 rounded">data-swipe="move"</code> - Swipe in progress</li>
            <li><code class="text-su-foreground bg-su-muted px-1 py-0.5 rounded">data-swipe="end"</code> - Swipe completed (past threshold)</li>
            <li><code class="text-su-foreground bg-su-muted px-1 py-0.5 rounded">data-swipe="cancel"</code> - Swipe cancelled</li>
        </ul>
    </SuSection>

    @* Accessibility Considerations *@
    <SuSection Title="Accessibility Considerations">
        <SuText>
            When building your toast abstraction, keep these accessibility best practices in mind:
        </SuText>
        <ul class="list-disc ml-6 mt-4 space-y-2 text-su-muted-foreground">
            <li>
                <strong class="text-su-foreground">Provide GetAnnouncementText:</strong>
                This function tells screen readers what to announce for each toast.
            </li>
            <li>
                <strong class="text-su-foreground">Use Assertive for errors:</strong>
                Set <code class="text-su-foreground bg-su-muted px-1 py-0.5 rounded">Priority = ToastPriority.Assertive</code>
                for error toasts to announce immediately.
            </li>
            <li>
                <strong class="text-su-foreground">Use Polite for non-critical:</strong>
                Success and info toasts should use the default Polite priority.
            </li>
            <li>
                <strong class="text-su-foreground">Give errors longer duration:</strong>
                Error messages should remain visible longer (e.g., 8-10 seconds).
            </li>
            <li>
                <strong class="text-su-foreground">Document the hotkey:</strong>
                Let users know they can press the configured hotkey to focus the toast region.
            </li>
            <li>
                <strong class="text-su-foreground">Localize AriaLabel:</strong>
                The AriaLabel on ToastRegion should be localized (e.g., "Notifications", "Aviseringar").
            </li>
        </ul>
    </SuSection>
</div>

@code {
    private const string contentTypeCode = @"// Models/AppToastContent.cs
public record AppToastContent
{
    public string? Title { get; init; }
    public string? Description { get; init; }
    public string Variant { get; init; } = ""default"";
    public AppToastAction? Action { get; init; }
}

public record AppToastAction
{
    public required string Label { get; init; }
    public Action? OnClick { get; init; }
    public string? AltText { get; init; }
}";

    private const string extensionMethodsCode = @"// Extensions/ToastQueueExtensions.cs
public static class ToastQueueExtensions
{
    public static string Show(this IToastQueue<AppToastContent> queue, string description)
        => queue.Add(new AppToastContent { Description = description },
            new ToastOptions { Timeout = 5000 });

    public static string Show(this IToastQueue<AppToastContent> queue, string title, string description)
        => queue.Add(new AppToastContent { Title = title, Description = description },
            new ToastOptions { Timeout = 5000 });

    public static string Success(this IToastQueue<AppToastContent> queue, string title, string description)
        => queue.Add(new AppToastContent { Title = title, Description = description, Variant = ""success"" },
            new ToastOptions { Timeout = 5000 });

    public static string Error(this IToastQueue<AppToastContent> queue, string title, string description)
        => queue.Add(new AppToastContent { Title = title, Description = description, Variant = ""error"" },
            new ToastOptions { Timeout = 8000, Priority = ToastPriority.Assertive });

    public static string Warning(this IToastQueue<AppToastContent> queue, string title, string description)
        => queue.Add(new AppToastContent { Title = title, Description = description, Variant = ""warning"" },
            new ToastOptions { Timeout = 6000, Priority = ToastPriority.Assertive });

    public static string ShowWithAction(
        this IToastQueue<AppToastContent> queue,
        string title,
        string description,
        AppToastAction action)
        => queue.Add(
            new AppToastContent { Title = title, Description = description, Action = action },
            new ToastOptions { Timeout = 6000 });
}";

    private const string registrationCode = @"// Program.cs
builder.Services.AddSummitUI();
builder.Services.AddToastQueue<AppToastContent>();";

    private const string toastComponentCode = @"@* Components/AppToast.razor *@
@using SummitUI
@inject IToastQueue<AppToastContent> Queue

<ToastRegion TContent=""AppToastContent""
             AriaLabel=""Notifications""
             GetAnnouncementText=""GetAnnouncementText""
             Hotkey=""@([""F8""])""
             class=""pointer-events-none fixed inset-0 flex flex-col-reverse items-end gap-2 p-4 sm:p-6 z-[9999] outline-none"">
    <ToastTemplate Context=""toast"">
        <Toast TContent=""AppToastContent""
               ToastData=""toast""
               SwipeDirection=""SummitUI.SwipeDirection.Right""
               SwipeThreshold=""50""
               class=""group pointer-events-auto relative flex w-full max-w-[420px] items-center justify-between gap-4 overflow-hidden rounded-md border bg-background p-4 shadow-lg transition-all animate-in slide-in-from-right-full data-[swipe=move]:transition-none data-[swipe=move]:translate-x-[var(--summit-toast-swipe-move-x)] data-[swipe=end]:animate-out data-[swipe=end]:slide-out-to-right-full""
               data-variant=""@toast.Content.Variant"">

            <div class=""grid gap-1"">
                @if (!string.IsNullOrEmpty(toast.Content.Title))
                {
                    <div class=""text-sm font-semibold"">@toast.Content.Title</div>
                }
                @if (!string.IsNullOrEmpty(toast.Content.Description))
                {
                    <div class=""text-sm text-muted-foreground"">@toast.Content.Description</div>
                }
            </div>

            <div class=""flex items-center gap-2"">
                @if (toast.Content.Action is not null)
                {
                    <button 
                        @onclick=""@(() => { toast.Content.Action.OnClick?.Invoke(); Queue.Close(toast.Key); })""
                        class=""inline-flex h-8 items-center justify-center rounded-md border px-3 text-sm font-medium"">
                        @toast.Content.Action.Label
                    </button>
                }
                <ToastCloseButton aria-label=""Close notification"" class=""..."">
                    Ã—
                </ToastCloseButton>
            </div>
        </Toast>
    </ToastTemplate>
</ToastRegion>

@code {
    private string GetAnnouncementText(AppToastContent content)
    {
        if (!string.IsNullOrEmpty(content.Title) && !string.IsNullOrEmpty(content.Description))
            return $""{content.Title}. {content.Description}"";
        return content.Title ?? content.Description ?? """";
    }
}";

    private const string layoutCode = @"@* MainLayout.razor *@
@inherits LayoutComponentBase

<div class=""app-container"">
    <NavMenu />
    <main>
        @Body
    </main>
</div>

<AppToast />";

    private const string usageCode = @"@* Any component in your app *@
@inject IToastQueue<AppToastContent> Toast

<button @onclick=""SaveData"">Save</button>

@code {
    private async Task SaveData()
    {
        try
        {
            await DataService.SaveAsync();
            Toast.Success(""Saved!"", ""Your changes have been saved."");
        }
        catch (ValidationException ex)
        {
            Toast.Warning(""Validation Error"", ex.Message);
        }
        catch (Exception ex)
        {
            Toast.Error(""Error"", ""Failed to save changes. Please try again."");
        }
    }
}";

    private const string cssVariantCode = @"/* Global CSS */
[data-variant=""success""] {
    background: var(--color-green-600);
    color: white;
    border-color: var(--color-green-600);
}

[data-variant=""error""] {
    background: var(--color-red-600);
    color: white;
    border-color: var(--color-red-600);
}

[data-variant=""warning""] {
    background: var(--color-yellow-500);
    color: black;
    border-color: var(--color-yellow-500);
}";

    private const string tailwindVariantCode = @"<Toast 
    class=""... 
        data-[variant=success]:bg-green-600 data-[variant=success]:text-white 
        data-[variant=error]:bg-red-600 data-[variant=error]:text-white 
        data-[variant=warning]:bg-yellow-500 data-[variant=warning]:text-black""
    data-variant=""@toast.Content.Variant"">
    ...
</Toast>";

    private const string swipeCode = @"@* Enable swipe-to-dismiss with visual feedback *@
<Toast TContent=""AppToastContent""
       ToastData=""toast""
       SwipeDirection=""SummitUI.SwipeDirection.Right""
       SwipeThreshold=""50""
       class=""...
           data-[swipe=move]:transition-none
           data-[swipe=move]:translate-x-[var(--summit-toast-swipe-move-x)]
           data-[swipe=end]:animate-out
           data-[swipe=end]:slide-out-to-right-full"">
    ...
</Toast>

@* Available SwipeDirection values: Left, Right, Up, Down *@
@* CSS variables during swipe: *@
@* --summit-toast-swipe-move-x (horizontal offset) *@
@* --summit-toast-swipe-move-y (vertical offset) *@";
}
