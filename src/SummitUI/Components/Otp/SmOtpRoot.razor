@namespace SummitUI
@using SummitUI.Components.Otp
@implements IAsyncDisposable

@{
    var context = BuildRenderContext();
    var textAlignCss = TextAlign switch
    {
        OtpTextAlign.Center => "center",
        OtpTextAlign.Right => "right",
        _ => "left"
    };
}

<div data-otp-root
     style="@($"position: relative; cursor: {(Disabled ? "default" : "text")}; user-select: none; -webkit-user-select: none;")"
     data-focused="@(_isFocused ? "true" : null)"
     data-disabled="@(Disabled ? "true" : null)"
     data-placeholder-shown="@(string.IsNullOrEmpty(CurrentValue) ? "true" : null)"
     @ref="_containerElement"
     @attributes="AdditionalAttributes">

    @* Visual slots layer (rendered by ChildContent or default) *@
    @* Using display:contents so parent's flex/grid layout passes through *@
    <div style="display: contents; pointer-events: none;">
        @if (ChildContent != null)
        {
            @ChildContent(context)
        }
        else
        {
            @* Default slot rendering *@
            <div style="display: flex; gap: 0.5rem;">
                @foreach (var slot in context.Slots)
                {
                    <SmOtpSlot Slot="@slot" @key="slot.Index" />
                }
            </div>
        }
    </div>

    @* Hidden input layer *@
    <div style="position: absolute; inset: 0; pointer-events: none;">
        <input data-otp-input
               type="text"
               inputmode="@InputMode"
               autocomplete="@AutoComplete"
               maxlength="@MaxLength"
               value="@CurrentValue"
               disabled="@Disabled"
               name="@Name"
               id="@Id"
               aria-label="@AriaLabel"
               aria-labelledby="@AriaLabelledBy"
               pattern="@Pattern"
               aria-placeholder="@Placeholder"
               style="@($@"
                   position: absolute;
                   inset: 0;
                   width: 100%;
                   height: 100%;
                   display: flex;
                   text-align: {textAlignCss};
                   opacity: 1;
                   color: transparent;
                   pointer-events: all;
                   background: transparent;
                   caret-color: transparent;
                   border: 0 solid transparent;
                   outline: 0 solid transparent;
                   box-shadow: none;
                   line-height: 1;
                   letter-spacing: -.5em;
                   font-size: var(--otp-root-height, 1rem);
                   font-family: monospace;
                   font-variant-numeric: tabular-nums;
               ")"
               @oninput="HandleInput"
               @ref="_inputElement" />
    </div>
</div>
