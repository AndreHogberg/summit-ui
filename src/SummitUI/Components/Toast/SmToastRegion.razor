@namespace SummitUI
@typeparam TContent
@implements IAsyncDisposable

<div id="@_portalId"
     role="region"
     aria-label="@AriaLabel"
     tabindex="-1"
     data-portal-pending="@(UsePortal && !_portalCreated ? "true" : null)"
     style="@(UsePortal && !_portalCreated ? "opacity: 0; pointer-events: none;" : null)"
     @onmouseenter="HandleMouseEnter"
     @onmouseleave="HandleMouseLeave"
     @onfocusin="HandleFocusIn"
     @onfocusout="HandleFocusOut"
     @ref="_regionRef"
     @attributes="AdditionalAttributes">
    @if (Queue.VisibleToasts.Count > 0)
    {
        <CascadingValue Name="CloseToast" Value="@((Action<string>)Queue.Close)" IsFixed="true">
            @foreach (var toast in Queue.VisibleToasts)
            {
                @if (ToastTemplate is not null)
                {
                    <div style="display: contents;" @key="toast.Key">
                        @ToastTemplate(toast)
                    </div>
                }
            }
        </CascadingValue>
    }
</div>

@* Aria-live regions for screen reader announcements *@
@if (GetAnnouncementText is not null)
{
    <div aria-live="polite"
         aria-atomic="true"
         style="position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0, 0, 0, 0); white-space: nowrap; border: 0;">
        @{
            var politeToasts = Queue.VisibleToasts.Where(t => t.Priority == ToastPriority.Polite).ToList();
            if (politeToasts.Count > 0)
            {
                var latest = politeToasts[^1];
                @GetAnnouncementText(latest.Content)
            }
        }
    </div>

    <div aria-live="assertive"
         aria-atomic="true"
         style="position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0, 0, 0, 0); white-space: nowrap; border: 0;">
        @{
            var assertiveToasts = Queue.VisibleToasts.Where(t => t.Priority == ToastPriority.Assertive).ToList();
            if (assertiveToasts.Count > 0)
            {
                var latest = assertiveToasts[^1];
                @GetAnnouncementText(latest.Content)
            }
        }
    </div>
}
