@namespace SummitUI
@using Microsoft.AspNetCore.Components.Rendering

@* A cell in the calendar grid representing a single date. *@

@{
    RenderCell(__builder);
}

@code {
    private void RenderCell(RenderTreeBuilder builder)
    {
        var isSelected = Context.IsSelected(Date);
        var isToday = Context.IsToday(Date);
        var isFocused = Context.IsFocused(Date);
        var isOutsideMonth = Context.IsOutsideMonth(Date);
        var isUnavailable = Context.IsDateUnavailable(Date);
        var isDisabled = Context.Disabled;

        builder.OpenElement(0, "td");
        builder.AddAttribute(1, "role", "gridcell");
        builder.AddAttribute(2, "data-summit-calendar-cell", true);

        // Data attributes - always add or use null to remove
        builder.AddAttribute(3, "data-state", isSelected ? "selected" : null);
        builder.AddAttribute(4, "data-today", isToday ? (object)true : null);
        builder.AddAttribute(5, "data-outside-month", isOutsideMonth ? (object)true : null);
        builder.AddAttribute(6, "data-unavailable", isUnavailable ? (object)true : null);
        builder.AddAttribute(7, "data-disabled", isDisabled ? (object)true : null);

        builder.AddMultipleAttributes(8, AdditionalAttributes);

        // Provide cascading cell context
        var cellContext = new CalendarCellContext
        {
            Date = Date,
            IsSelected = isSelected,
            IsToday = isToday,
            IsFocused = isFocused,
            IsOutsideMonth = isOutsideMonth,
            IsUnavailable = isUnavailable,
            IsDisabled = isDisabled
        };

        builder.OpenComponent<CascadingValue<CalendarCellContext>>(9);
        builder.AddComponentParameter(10, "Value", cellContext);
        builder.AddComponentParameter(11, "IsFixed", false);
        builder.AddComponentParameter(12, "ChildContent", (RenderFragment)(childBuilder =>
        {
            if (ChildContent is not null)
            {
                childBuilder.AddContent(0, ChildContent(cellContext));
            }
            else if (SimpleContent is not null)
            {
                childBuilder.AddContent(0, SimpleContent);
            }
        }));
        builder.CloseComponent();

        builder.CloseElement();
    }
}
