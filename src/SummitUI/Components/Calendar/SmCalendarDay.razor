@namespace SummitUI

@* The interactive day button within a calendar cell. Handles selection and keyboard navigation focus. *@

<button type="button"
        data-summit-calendar-day
        data-date="@_date.ToString("yyyy-MM-dd")"
        tabindex="@_tabIndex"
        aria-selected="@(_isSelected ? "true" : null)"
        aria-disabled="@(_isUnavailable || _isDisabled ? "true" : null)"
        aria-current="@(_isToday ? "date" : null)"
        aria-label="@_ariaLabel"
        data-state="@(_isSelected ? "selected" : null)"
        data-today="@(_isToday ? true : null)"
        data-focused="@(_isFocused ? true : null)"
        data-outside-month="@(_isOutsideMonth ? true : null)"
        data-unavailable="@(_isUnavailable ? true : null)"
        data-disabled="@(_isDisabled ? true : null)"
        disabled="@(_isUnavailable || _isDisabled ? true : null)"
        @onclick="HandleClick"
        @onkeydown="HandleKeyDown"
        @ref="_elementRef"
        @attributes="AdditionalAttributes">
    @if (ChildContent is not null)
    {
        @ChildContent
    }
    else
    {
        @Context.GetDisplayDay(_date)
    }
</button>

@code {
    private DateOnly _date;
    private bool _isSelected;
    private bool _isToday;
    private bool _isFocused;
    private bool _isOutsideMonth;
    private bool _isUnavailable;
    private bool _isDisabled;
    private int _tabIndex;
    private string _ariaLabel = "";

    protected override void OnParametersSet()
    {
        _date = CellContext.Date;
        _isSelected = Context.IsSelected(_date);
        _isToday = Context.IsToday(_date);
        _isFocused = Context.IsFocused(_date);
        _isOutsideMonth = Context.IsOutsideMonth(_date);
        _isUnavailable = Context.IsDateUnavailable(_date);
        _isDisabled = Context.Disabled;

        // Use roving tabindex: only the focused date is in tab order
        _tabIndex = _isFocused ? 0 : -1;

        // Accessible label with full date (localized for the current calendar system)
        _ariaLabel = Context.GetLocalizedDateString(_date);
        if (_isToday) _ariaLabel += " (today)";
        if (_isSelected) _ariaLabel += " (selected)";
    }
}
