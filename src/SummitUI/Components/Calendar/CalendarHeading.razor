@namespace SummitUI
@using Microsoft.AspNetCore.Components.Rendering

@* Displays the current month and year. Acts as a live region for screen readers. *@

@{
    RenderHeading(__builder);
}

@code {
    [CascadingParameter]
    private CalendarContext Context { get; set; } = default!;

    /// <summary>
    /// The heading level (1-6). Defaults to 2.
    /// </summary>
    [Parameter] public int Level { get; set; } = 2;

    /// <summary>
    /// Custom format for the heading. If not provided, uses localized month/year.
    /// </summary>
    [Parameter] public RenderFragment? ChildContent { get; set; }

    /// <summary>
    /// Additional attributes to apply to the heading element.
    /// </summary>
    [Parameter(CaptureUnmatchedValues = true)]
    public Dictionary<string, object>? AdditionalAttributes { get; set; }

    protected override void OnInitialized()
    {
        Context.OnStateChanged += StateHasChanged;
    }

    private void RenderHeading(RenderTreeBuilder builder)
    {
        var tag = $"h{Math.Clamp(Level, 1, 6)}";

        builder.OpenElement(0, tag);
        builder.AddAttribute(1, "id", Context.HeadingId);
        builder.AddAttribute(2, "data-summit-calendar-heading", true);
        builder.AddAttribute(3, "aria-live", "polite");
        builder.AddAttribute(4, "aria-atomic", "true");
        builder.AddMultipleAttributes(5, AdditionalAttributes);

        if (ChildContent is not null)
        {
            builder.AddContent(6, ChildContent);
        }
        else
        {
            var heading = !string.IsNullOrEmpty(Context.MonthName)
                ? Context.MonthName
                : $"{Context.DisplayedMonth:MMMM yyyy}";
            builder.AddContent(6, heading);
        }

        builder.CloseElement();
    }
}
