@page "/datefield"
@rendermode InteractiveAuto
@using System.ComponentModel.DataAnnotations

<h1>DateField Component Demo</h1>

<section data-testid="basic-section">
    <h2>Basic DateOnly Field</h2>
    <p>A simple date field with ISO format. Use Arrow keys to navigate and increment/decrement, or type numbers directly.</p>
    
    <SmDateFieldRoot @bind-Value="basicDate" Format="yyyy-MM-dd">
        <SmDateFieldLabel class="datefield-label">Select a date</SmDateFieldLabel>
        <SmDateFieldInput class="datefield-input" />
    </SmDateFieldRoot>
    
    <p style="margin-top: 1rem;">Selected: <strong data-testid="basic-value">@(basicDate?.ToString("yyyy-MM-dd") ?? "None")</strong></p>
</section>

<section style="margin-top: 2rem;" data-testid="datetime-section">
    <h2>DateTime Field (with time)</h2>
    <p>A date-time field showing date and time segments (24-hour format).</p>
    
    <SmDateFieldRoot @bind-DateTimeValue="basicDateTime" Format="yyyy-MM-dd">
        <SmDateFieldLabel class="datefield-label">Select date and time</SmDateFieldLabel>
        <SmDateFieldInput class="datefield-input" />
    </SmDateFieldRoot>
    
    <p style="margin-top: 1rem;">Selected: <strong data-testid="datetime-value">@(basicDateTime?.ToString("yyyy-MM-dd HH:mm") ?? "None")</strong></p>
</section>

<section style="margin-top: 2rem;" data-testid="datetime-12hour-section">
    <h2>DateTime Field (12-hour format)</h2>
    <p>A date-time field with 12-hour format and AM/PM indicator.</p>
    
    <SmDateFieldRoot @bind-DateTimeValue="dateTime12Hour" Format="MM/dd/yyyy" TimeFormat="hh:mm">
        <SmDateFieldLabel class="datefield-label">Select date and time</SmDateFieldLabel>
        <SmDateFieldInput class="datefield-input" />
    </SmDateFieldRoot>
    
    <p style="margin-top: 1rem;">Selected: <strong data-testid="datetime-12hour-value">@(dateTime12Hour?.ToString("MM/dd/yyyy hh:mm tt") ?? "None")</strong></p>
</section>

<section style="margin-top: 2rem;" data-testid="swedish-section">
    <h2>Swedish Format (yyyy-MM-dd)</h2>
    <p>Date field with Swedish-style formatting.</p>
    
    <SmDateFieldRoot @bind-Value="swedishDate" Format="yyyy-MM-dd">
        <SmDateFieldLabel class="datefield-label">Välj ett datum</SmDateFieldLabel>
        <SmDateFieldInput class="datefield-input" />
    </SmDateFieldRoot>
    
    <p style="margin-top: 1rem;">Selected: <strong data-testid="swedish-value">@(swedishDate?.ToString("yyyy-MM-dd") ?? "None")</strong></p>
</section>

<section style="margin-top: 2rem;" data-testid="us-section">
    <h2>US Format (MM/dd/yyyy)</h2>
    <p>Date field with US-style formatting.</p>
    
    <SmDateFieldRoot @bind-Value="usDate" Format="MM/dd/yyyy">
        <SmDateFieldLabel class="datefield-label">Select a date</SmDateFieldLabel>
        <SmDateFieldInput class="datefield-input" />
    </SmDateFieldRoot>
    
    <p style="margin-top: 1rem;">Selected: <strong data-testid="us-value">@(usDate?.ToString("MM/dd/yyyy") ?? "None")</strong></p>
</section>

<section style="margin-top: 2rem;" data-testid="uk-section">
    <h2>UK Format (dd/MM/yyyy)</h2>
    <p>Date field with UK-style formatting.</p>
    
    <SmDateFieldRoot @bind-Value="ukDate" Format="dd/MM/yyyy">
        <SmDateFieldLabel class="datefield-label">Select a date</SmDateFieldLabel>
        <SmDateFieldInput class="datefield-input" />
    </SmDateFieldRoot>
    
    <p style="margin-top: 1rem;">Selected: <strong data-testid="uk-value">@(ukDate?.ToString("dd/MM/yyyy") ?? "None")</strong></p>
</section>

<section style="margin-top: 2rem;" data-testid="german-section">
    <h2>German Format (dd.MM.yyyy)</h2>
    <p>Date field with German-style formatting using dots as separators.</p>
    
    <SmDateFieldRoot @bind-Value="germanDate" Format="dd.MM.yyyy">
        <SmDateFieldLabel class="datefield-label">Datum auswählen</SmDateFieldLabel>
        <SmDateFieldInput class="datefield-input" />
    </SmDateFieldRoot>
    
    <p style="margin-top: 1rem;">Selected: <strong data-testid="german-value">@(germanDate?.ToString("dd.MM.yyyy") ?? "None")</strong></p>
</section>

<section style="margin-top: 2rem;" data-testid="minmax-section">
    <h2>Min/Max Validation</h2>
    <p>Date field with minimum and maximum date constraints. The field shows invalid state when out of range.</p>
    
    <SmDateFieldRoot @bind-Value="constrainedDate" Format="yyyy-MM-dd" MinValue="@minDate" MaxValue="@maxDate">
        <SmDateFieldLabel class="datefield-label">Select a date (Jan 1, 2025 - Dec 31, 2025)</SmDateFieldLabel>
        <SmDateFieldInput class="datefield-input" />
    </SmDateFieldRoot>
    
    <p style="margin-top: 1rem;">
        Selected: <strong data-testid="minmax-value">@(constrainedDate?.ToString("yyyy-MM-dd") ?? "None")</strong>
        @if (constrainedDate.HasValue && (constrainedDate < minDate || constrainedDate > maxDate))
        {
            <span style="color: #dc3545; margin-left: 0.5rem;" data-testid="minmax-error">Date must be between @minDate.ToString("yyyy-MM-dd") and @maxDate.ToString("yyyy-MM-dd")</span>
        }
    </p>
</section>

<section style="margin-top: 2rem;" data-testid="placeholder-section">
    <h2>With Placeholder</h2>
    <p>Date field with a placeholder date shown when no value is set. Press Backspace to clear.</p>
    
    <SmDateFieldRoot Value="@nullableDate" ValueChanged="v => nullableDate = v" Format="yyyy-MM-dd" Placeholder="@placeholderDate">
        <SmDateFieldLabel class="datefield-label">Date with placeholder</SmDateFieldLabel>
        <SmDateFieldInput class="datefield-input" />
    </SmDateFieldRoot>
    
    <p style="margin-top: 1rem;">Selected: <strong data-testid="placeholder-value">@(nullableDate?.ToString("yyyy-MM-dd") ?? "None (showing placeholder)")</strong></p>
</section>

<section style="margin-top: 2rem;" data-testid="disabled-section">
    <h2>Disabled State</h2>
    <p>The date field can be disabled.</p>
    
    <SmDateFieldRoot Value="@disabledDate" Format="yyyy-MM-dd" Disabled="true">
        <SmDateFieldLabel class="datefield-label">Disabled date field</SmDateFieldLabel>
        <SmDateFieldInput class="datefield-input" />
    </SmDateFieldRoot>
</section>

<section style="margin-top: 2rem;" data-testid="readonly-section">
    <h2>Read-Only State</h2>
    <p>The date field can be read-only (visible but not editable).</p>
    
    <SmDateFieldRoot Value="@readOnlyDate" Format="yyyy-MM-dd" ReadOnly="true">
        <SmDateFieldLabel class="datefield-label">Read-only date field</SmDateFieldLabel>
        <SmDateFieldInput class="datefield-input" />
    </SmDateFieldRoot>
</section>

<section style="margin-top: 2rem;" data-testid="invalid-section">
    <h2>Invalid State</h2>
    <p>The date field showing an invalid/error state.</p>
    
    <SmDateFieldRoot @bind-Value="invalidDate" Format="yyyy-MM-dd" Invalid="true">
        <SmDateFieldLabel class="datefield-label">Date with error</SmDateFieldLabel>
        <SmDateFieldInput class="datefield-input" />
    </SmDateFieldRoot>
    <p style="color: #dc3545; font-size: 0.875rem; margin-top: 0.25rem;">Please enter a valid date</p>
</section>

<section style="margin-top: 2rem;" data-testid="editform-section">
    <h2>EditForm Integration</h2>
    <p>DateField integrated with Blazor EditForm for model validation.</p>

    <EditForm EditContext="editContext" OnSubmit="HandleEditFormSubmit" FormName="dateFieldEditForm">
        <DataAnnotationsValidator />

        <div style="margin-bottom: 1rem;">
            <SmDateFieldRoot @bind-Value="formModel.BirthDate"
                           Format="yyyy-MM-dd"
                           Name="birthDate"
                           Required="true"
                           Invalid="@(editFormSubmitted && formModel.BirthDate == null)">
                <SmDateFieldLabel class="datefield-label" data-testid="editform-birthdate-label">Birth Date (Required)</SmDateFieldLabel>
                <SmDateFieldInput class="datefield-input" data-testid="editform-birthdate-input" />
            </SmDateFieldRoot>
            <ValidationMessage For="@(() => formModel.BirthDate)" />
            @if (editFormSubmitted && formModel.BirthDate == null)
            {
                <p class="validation-error" style="color: #dc3545; font-size: 0.875rem; margin-top: 0.25rem;">Birth date is required</p>
            }
        </div>

        <div style="margin-bottom: 1rem;">
            <SmDateFieldRoot @bind-DateTimeValue="formModel.AppointmentTime"
                           Format="yyyy-MM-dd"
                           Name="appointmentTime"
                           MinDateTime="@DateTime.Now"
                           MaxDateTime="@DateTime.Now.AddYears(1)">
                <SmDateFieldLabel class="datefield-label" data-testid="editform-appointment-label">Appointment (Optional, future dates only)</SmDateFieldLabel>
                <SmDateFieldInput class="datefield-input" data-testid="editform-appointment-input" />
            </SmDateFieldRoot>
        </div>

        <button type="submit" class="btn btn-primary" data-testid="editform-submit">Submit</button>
    </EditForm>

    <div style="margin-top: 1rem;" data-testid="editform-result">
        <p>Birth Date: <strong data-testid="editform-birthdate-value">@(formModel.BirthDate?.ToString("yyyy-MM-dd") ?? "None")</strong></p>
        <p>Appointment: <strong data-testid="editform-appointment-value">@(formModel.AppointmentTime?.ToString("yyyy-MM-dd HH:mm") ?? "None")</strong></p>
        @if (editFormSubmitSuccess)
        {
            <p style="color: #198754;" data-testid="editform-success-message">Form submitted successfully!</p>
        }
    </div>
</section>

<section style="margin-top: 2rem;" data-testid="form-section">
    <h2>Basic Form</h2>
    <p>DateField with form name for native form submission.</p>

    <form @onsubmit="HandleBasicFormSubmit" @onsubmit:preventDefault>
        <div style="margin-bottom: 1rem;">
            <SmDateFieldRoot @bind-Value="basicFormDate" Format="yyyy-MM-dd" Name="eventDate" Required="true">
                <SmDateFieldLabel class="datefield-label">Event Date</SmDateFieldLabel>
                <SmDateFieldInput class="datefield-input" data-testid="form-date-input" />
            </SmDateFieldRoot>
        </div>
        <button type="submit" class="btn btn-primary" data-testid="form-submit">Submit Form</button>
    </form>
    
    <p style="margin-top: 1rem;">Selected: <strong data-testid="form-value">@(basicFormDate?.ToString("yyyy-MM-dd") ?? "None")</strong></p>
    @if (basicFormSubmitted)
    {
        <p style="color: #198754;" data-testid="form-success-message">Form submitted!</p>
    }
</section>

@code {
    // Basic examples
    private DateOnly? basicDate = DateOnly.FromDateTime(DateTime.Today);
    private DateTime? basicDateTime = DateTime.Now;
    private DateTime? dateTime12Hour = DateTime.Now;
    
    // Format examples
    private DateOnly? swedishDate = DateOnly.FromDateTime(DateTime.Today);
    private DateOnly? usDate = DateOnly.FromDateTime(DateTime.Today);
    private DateOnly? ukDate = DateOnly.FromDateTime(DateTime.Today);
    private DateOnly? germanDate = DateOnly.FromDateTime(DateTime.Today);
    
    // Min/Max validation
    private DateOnly? constrainedDate = DateOnly.FromDateTime(DateTime.Today);
    private DateOnly minDate = new DateOnly(2025, 1, 1);
    private DateOnly maxDate = new DateOnly(2025, 12, 31);
    
    // Placeholder example
    private DateOnly? nullableDate = null;
    private DateOnly placeholderDate = new DateOnly(2025, 1, 1);
    
    // States
    private DateOnly? disabledDate = DateOnly.FromDateTime(DateTime.Today);
    private DateOnly? readOnlyDate = DateOnly.FromDateTime(DateTime.Today);
    private DateOnly? invalidDate = null;
    
    // EditForm
    private DateFieldFormModel formModel = new();
    private EditContext? editContext;
    private bool editFormSubmitted;
    private bool editFormSubmitSuccess;
    
    // Basic form
    private DateOnly? basicFormDate = DateOnly.FromDateTime(DateTime.Today);
    private bool basicFormSubmitted;

    protected override void OnInitialized()
    {
        editContext = new EditContext(formModel);
    }

    private void HandleEditFormSubmit()
    {
        editFormSubmitted = true;
        editFormSubmitSuccess = false;

        if (formModel.BirthDate != null)
        {
            editFormSubmitSuccess = true;
        }
    }

    private void HandleBasicFormSubmit()
    {
        basicFormSubmitted = true;
    }

    public class DateFieldFormModel
    {
        [Required(ErrorMessage = "Birth date is required")]
        public DateOnly? BirthDate { get; set; }

        public DateTime? AppointmentTime { get; set; }
    }
}

<style>
    .datefield-label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: 500;
        color: #333;
    }
    
    .datefield-input {
        display: inline-flex;
        align-items: center;
        gap: 0;
        padding: 0.5rem 0.75rem;
        background: white;
        border: 1px solid #ccc;
        border-radius: 6px;
        font-size: 0.875rem;
        font-family: inherit;
    }
    
    .datefield-input:focus-within {
        border-color: #0d6efd;
        box-shadow: 0 0 0 3px rgba(13, 110, 253, 0.25);
    }
    
    [data-disabled] .datefield-input {
        background: #f5f5f5;
        color: #999;
        cursor: not-allowed;
    }
    
    [data-readonly] .datefield-input {
        background: #f9f9f9;
    }
    
    [data-invalid] .datefield-input {
        border-color: #dc3545;
    }
    
    [data-invalid] .datefield-input:focus-within {
        box-shadow: 0 0 0 3px rgba(220, 53, 69, 0.25);
    }
    
    /* Segment styling */
    [data-segment]:not([data-segment="literal"]) {
        padding: 0.125rem 0.25rem;
        border-radius: 4px;
        outline: none;
        min-width: 1.5em;
        text-align: center;
    }
    
    [data-segment]:not([data-segment="literal"]):focus {
        background: #e7f1ff;
        color: #0d6efd;
    }
    
    [data-segment="literal"] {
        color: #666;
        padding: 0 0.125rem;
    }
    
    [data-segment][data-placeholder] {
        color: #999;
    }
    
    section {
        padding: 1rem;
        border: 1px solid #eee;
        border-radius: 8px;
        background: #fafafa;
    }

    section h2 {
        margin-top: 0;
    }
    
    .btn {
        padding: 0.5rem 1rem;
        border: none;
        border-radius: 6px;
        font-size: 0.875rem;
        cursor: pointer;
    }
    
    .btn-primary {
        background: #0d6efd;
        color: white;
    }
    
    .btn-primary:hover {
        background: #0b5ed7;
    }
</style>
