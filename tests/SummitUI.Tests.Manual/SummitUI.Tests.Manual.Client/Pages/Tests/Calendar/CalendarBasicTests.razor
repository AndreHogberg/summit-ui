@page "/tests/calendar/basic"
@rendermode InteractiveWebAssembly

@if (!RendererInfo.IsInteractive)
{
    <div data-testid="page-loading">Loading...</div>
}
else
{
<div data-testid="page-ready">
    <h1>Calendar Basic Tests</h1>
    
    <div class="test-section" data-testid="basic-section">
        <h2>Basic Calendar</h2>
        <SmCalendarRoot @bind-Value="_selectedDate" data-testid="calendar-basic" Context="calendarContext">
            <SmCalendarHeader class="calendar-header">
                <SmCalendarPrevButton class="calendar-nav-button" data-testid="prev-button" />
                <SmCalendarHeading class="calendar-heading" data-testid="heading" />
                <SmCalendarNextButton class="calendar-nav-button" data-testid="next-button" />
            </SmCalendarHeader>
            <SmCalendarGrid class="calendar-grid" data-testid="grid">
                <SmCalendarGridHead>
                    <SmCalendarGridRow>
                        @for (int i = 0; i < calendarContext.Weekdays.Length; i++)
                        {
                            var idx = i;
                            <SmCalendarHeadCell Abbreviation="@calendarContext.WeekdaysLong[idx]" class="calendar-head-cell">
                                @calendarContext.Weekdays[idx]
                            </SmCalendarHeadCell>
                        }
                    </SmCalendarGridRow>
                </SmCalendarGridHead>
                <SmCalendarGridBody>
                    @foreach (var week in calendarContext.CurrentMonth.Weeks)
                    {
                        <SmCalendarGridRow>
                            @foreach (var date in week)
                            {
                                <SmCalendarCell Date="@date">
                                    <SmCalendarDay class="calendar-day" />
                                </SmCalendarCell>
                            }
                        </SmCalendarGridRow>
                    }
                </SmCalendarGridBody>
            </SmCalendarGrid>
        </SmCalendarRoot>
        <p data-testid="basic-value">Selected: @(_selectedDate?.ToString("yyyy-MM-dd") ?? "None")</p>
    </div>

    <div class="test-section" data-testid="fixed-weeks-section">
        <h2>Fixed Weeks Calendar</h2>
        <SmCalendarRoot @bind-Value="_selectedDate2" FixedWeeks="true" data-testid="calendar-fixed-weeks" Context="ctx">
            <SmCalendarHeader class="calendar-header">
                <SmCalendarPrevButton class="calendar-nav-button" />
                <SmCalendarHeading class="calendar-heading" />
                <SmCalendarNextButton class="calendar-nav-button" />
            </SmCalendarHeader>
            <SmCalendarGrid class="calendar-grid">
                <SmCalendarGridHead>
                    <SmCalendarGridRow>
                        @for (int i = 0; i < ctx.Weekdays.Length; i++)
                        {
                            var idx = i;
                            <SmCalendarHeadCell Abbreviation="@ctx.WeekdaysLong[idx]" class="calendar-head-cell">
                                @ctx.Weekdays[idx]
                            </SmCalendarHeadCell>
                        }
                    </SmCalendarGridRow>
                </SmCalendarGridHead>
                <SmCalendarGridBody>
                    @foreach (var week in ctx.CurrentMonth.Weeks)
                    {
                        <SmCalendarGridRow>
                            @foreach (var date in week)
                            {
                                <SmCalendarCell Date="@date">
                                    <SmCalendarDay class="calendar-day" />
                                </SmCalendarCell>
                            }
                        </SmCalendarGridRow>
                    }
                </SmCalendarGridBody>
            </SmCalendarGrid>
        </SmCalendarRoot>
        <p data-testid="fixed-weeks-value">Selected: @(_selectedDate2?.ToString("yyyy-MM-dd") ?? "None")</p>
    </div>

    <div class="test-section" data-testid="disabled-section">
        <h2>Disabled Calendar</h2>
        <SmCalendarRoot @bind-Value="_selectedDate3" Disabled="true" data-testid="calendar-disabled" Context="ctx">
            <SmCalendarHeader class="calendar-header">
                <SmCalendarPrevButton class="calendar-nav-button" />
                <SmCalendarHeading class="calendar-heading" />
                <SmCalendarNextButton class="calendar-nav-button" />
            </SmCalendarHeader>
            <SmCalendarGrid class="calendar-grid">
                <SmCalendarGridHead>
                    <SmCalendarGridRow>
                        @for (int i = 0; i < ctx.Weekdays.Length; i++)
                        {
                            var idx = i;
                            <SmCalendarHeadCell Abbreviation="@ctx.WeekdaysLong[idx]" class="calendar-head-cell">
                                @ctx.Weekdays[idx]
                            </SmCalendarHeadCell>
                        }
                    </SmCalendarGridRow>
                </SmCalendarGridHead>
                <SmCalendarGridBody>
                    @foreach (var week in ctx.CurrentMonth.Weeks)
                    {
                        <SmCalendarGridRow>
                            @foreach (var date in week)
                            {
                                <SmCalendarCell Date="@date">
                                    <SmCalendarDay class="calendar-day" />
                                </SmCalendarCell>
                            }
                        </SmCalendarGridRow>
                    }
                </SmCalendarGridBody>
            </SmCalendarGrid>
        </SmCalendarRoot>
    </div>

    <div class="test-section" data-testid="minmax-section">
        <h2>Min/Max Constraints</h2>
        <SmCalendarRoot @bind-Value="_selectedDate4" MinValue="@_minDate" MaxValue="@_maxDate" data-testid="calendar-minmax" Context="ctx">
            <SmCalendarHeader class="calendar-header">
                <SmCalendarPrevButton class="calendar-nav-button" />
                <SmCalendarHeading class="calendar-heading" />
                <SmCalendarNextButton class="calendar-nav-button" />
            </SmCalendarHeader>
            <SmCalendarGrid class="calendar-grid">
                <SmCalendarGridHead>
                    <SmCalendarGridRow>
                        @for (int i = 0; i < ctx.Weekdays.Length; i++)
                        {
                            var idx = i;
                            <SmCalendarHeadCell Abbreviation="@ctx.WeekdaysLong[idx]" class="calendar-head-cell">
                                @ctx.Weekdays[idx]
                            </SmCalendarHeadCell>
                        }
                    </SmCalendarGridRow>
                </SmCalendarGridHead>
                <SmCalendarGridBody>
                    @foreach (var week in ctx.CurrentMonth.Weeks)
                    {
                        <SmCalendarGridRow>
                            @foreach (var date in week)
                            {
                                <SmCalendarCell Date="@date">
                                    <SmCalendarDay class="calendar-day" />
                                </SmCalendarCell>
                            }
                        </SmCalendarGridRow>
                    }
                </SmCalendarGridBody>
            </SmCalendarGrid>
        </SmCalendarRoot>
        <p>Min: @_minDate.ToString("yyyy-MM-dd"), Max: @_maxDate.ToString("yyyy-MM-dd")</p>
        <p data-testid="minmax-value">Selected: @(_selectedDate4?.ToString("yyyy-MM-dd") ?? "None")</p>
    </div>

    <div class="test-section" data-testid="monday-start-section">
        <h2>Week Starts Monday</h2>
        <SmCalendarRoot @bind-Value="_selectedDate5" WeekStartsOn="DayOfWeek.Monday" data-testid="calendar-monday" Context="ctx">
            <SmCalendarHeader class="calendar-header">
                <SmCalendarPrevButton class="calendar-nav-button" />
                <SmCalendarHeading class="calendar-heading" />
                <SmCalendarNextButton class="calendar-nav-button" />
            </SmCalendarHeader>
            <SmCalendarGrid class="calendar-grid">
                <SmCalendarGridHead>
                    <SmCalendarGridRow>
                        @for (int i = 0; i < ctx.Weekdays.Length; i++)
                        {
                            var idx = i;
                            <SmCalendarHeadCell Abbreviation="@ctx.WeekdaysLong[idx]" class="calendar-head-cell" data-testid="@($"weekday-{idx}")">
                                @ctx.Weekdays[idx]
                            </SmCalendarHeadCell>
                        }
                    </SmCalendarGridRow>
                </SmCalendarGridHead>
                <SmCalendarGridBody>
                    @foreach (var week in ctx.CurrentMonth.Weeks)
                    {
                        <SmCalendarGridRow>
                            @foreach (var date in week)
                            {
                                <SmCalendarCell Date="@date">
                                    <SmCalendarDay class="calendar-day" />
                                </SmCalendarCell>
                            }
                        </SmCalendarGridRow>
                    }
                </SmCalendarGridBody>
            </SmCalendarGrid>
        </SmCalendarRoot>
    </div>

    <div class="test-section" data-testid="announcement-section">
        <h2>Selection Announcement Test</h2>
        <SmCalendarRoot @bind-Value="_selectedDate6" data-testid="calendar-announcement" Context="ctx">
            <SmCalendarHeader class="calendar-header">
                <SmCalendarPrevButton class="calendar-nav-button" />
                <SmCalendarHeading class="calendar-heading" />
                <SmCalendarNextButton class="calendar-nav-button" />
            </SmCalendarHeader>
            <SmCalendarGrid class="calendar-grid">
                <SmCalendarGridHead>
                    <SmCalendarGridRow>
                        @for (int i = 0; i < ctx.Weekdays.Length; i++)
                        {
                            var idx = i;
                            <SmCalendarHeadCell Abbreviation="@ctx.WeekdaysLong[idx]" class="calendar-head-cell">
                                @ctx.Weekdays[idx]
                            </SmCalendarHeadCell>
                        }
                    </SmCalendarGridRow>
                </SmCalendarGridHead>
                <SmCalendarGridBody>
                    @foreach (var week in ctx.CurrentMonth.Weeks)
                    {
                        <SmCalendarGridRow>
                            @foreach (var date in week)
                            {
                                <SmCalendarCell Date="@date">
                                    <SmCalendarDay class="calendar-day" />
                                </SmCalendarCell>
                            }
                        </SmCalendarGridRow>
                    }
                </SmCalendarGridBody>
            </SmCalendarGrid>
        </SmCalendarRoot>
        <p data-testid="announcement-value">Selected: @(_selectedDate6?.ToString("yyyy-MM-dd") ?? "None")</p>
    </div>
</div>
}

<style>
    .test-section {
        margin-bottom: 2rem;
        padding: 1rem;
        border: 1px solid #eee;
    }

    .calendar-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 0.5rem;
    }

    .calendar-heading {
        font-weight: 600;
        font-size: 1rem;
    }

    .calendar-nav-button {
        padding: 0.25rem 0.5rem;
        border: 1px solid #ccc;
        background: white;
        cursor: pointer;
        border-radius: 4px;
    }

    .calendar-nav-button:hover:not(:disabled) {
        background: #f0f0f0;
    }

    .calendar-nav-button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }

    .calendar-grid {
        border-collapse: collapse;
    }

    .calendar-head-cell {
        padding: 0.5rem;
        text-align: center;
        font-weight: 500;
        color: #666;
    }

    .calendar-day {
        width: 2.5rem;
        height: 2.5rem;
        border: none;
        background: transparent;
        cursor: pointer;
        border-radius: 50%;
        font-size: 0.875rem;
    }

    .calendar-day:hover:not(:disabled) {
        background: #f0f0f0;
    }

    .calendar-day[data-today] {
        font-weight: bold;
        color: #0078d4;
    }

    .calendar-day[data-state="selected"] {
        background: #0078d4;
        color: white;
    }

    .calendar-day[data-outside-month] {
        color: #ccc;
    }

    .calendar-day[data-unavailable],
    .calendar-day:disabled {
        color: #ccc;
        cursor: not-allowed;
    }

    .calendar-day[data-focused] {
        outline: 2px solid #0078d4;
        outline-offset: 2px;
    }

    [data-disabled] {
        opacity: 0.5;
        pointer-events: none;
    }
</style>

@code {
    private DateOnly? _selectedDate = null;
    private DateOnly? _selectedDate2 = null;
    private DateOnly? _selectedDate3 = new DateOnly(2025, 1, 15);
    private DateOnly? _selectedDate4 = null;
    private DateOnly? _selectedDate5 = null;
    private DateOnly? _selectedDate6 = null;
    
    private DateOnly _minDate = DateOnly.FromDateTime(DateTime.Today.AddDays(-7));
    private DateOnly _maxDate = DateOnly.FromDateTime(DateTime.Today.AddDays(30));
}
