@page "/tests/toast/accessibility"
@rendermode InteractiveWebAssembly
@inject IToastQueue<TestToastContent> Toasts

@if (!RendererInfo.IsInteractive)
{
    <div data-testid="page-loading">Loading...</div>
}
else
{
<div data-testid="page-ready">
    <h1>Toast Accessibility Tests</h1>
    
    <div class="test-section">
        <h2>ARIA Attributes Test</h2>
        <p>Press F8 to jump to the toast viewport.</p>
        
        <button type="button" @onclick="ShowForegroundToast" data-testid="show-foreground">
            Show Foreground Toast (assertive)
        </button>
        <button type="button" @onclick="ShowBackgroundToast" data-testid="show-background">
            Show Background Toast (polite)
        </button>
    </div>

    <SmToastRegion TContent="TestToastContent"
                 AriaLabel="Test notifications (F8)"
                 Hotkey="@(["F8"])"
                 GetAnnouncementText="GetAnnouncementText"
                 class="toast-viewport"
                 data-testid="toast-viewport">
        <ToastTemplate Context="toast">
            @{
                var titleId = $"toast-title-{toast.Key}";
                var descId = $"toast-desc-{toast.Key}";
                var urgency = toast.Content.Variant == "assertive" ? ToastUrgency.Assertive : ToastUrgency.Polite;
                var testIdPrefix = toast.Content.Variant == "assertive" ? "foreground" : "background";
            }
            <SmToast TContent="TestToastContent"
                   ToastData="toast"
                   Urgency="urgency"
                   SwipeDirection="SwipeDirection.Right"
                   AriaLabelledBy="@(!string.IsNullOrEmpty(toast.Content.Title) ? titleId : null)"
                   AriaDescribedBy="@descId"
                   class="toast-root"
                   data-testid="@($"{testIdPrefix}-toast")"
                   data-variant="@toast.Content.Variant">
                @if (!string.IsNullOrEmpty(toast.Content.Title))
                {
                    <div id="@titleId" data-summit-toast-title class="toast-title" data-testid="@($"{testIdPrefix}-title")">
                        @toast.Content.Title
                    </div>
                }
                <div id="@descId" data-summit-toast-description class="toast-description" data-testid="@($"{testIdPrefix}-description")">
                    @toast.Content.Description
                </div>
                @if (toast.Content.Action is not null)
                {
                    <button type="button"
                            @onclick="@(() => { toast.Content.Action.OnClick?.Invoke(); Toasts.Close(toast.Key); })"
                            data-summit-toast-action
                            data-summit-toast-announce-alt="@toast.Content.Action.AltText"
                            data-testid="foreground-action">
                        @toast.Content.Action.Label
                    </button>
                }
                <SmToastCloseButton aria-label="Dismiss notification"
                                  class="toast-close"
                                  data-testid="@($"{testIdPrefix}-close")">
                    Ã—
                </SmToastCloseButton>
            </SmToast>
        </ToastTemplate>
    </SmToastRegion>
    
    <button type="button" data-testid="focus-test-after">Focusable element after viewport</button>
</div>
}

@code {
    private void ShowForegroundToast()
    {
        Toasts.Add(new TestToastContent
        {
            Title = "Foreground Toast",
            Description = "This is an assertive announcement.",
            Variant = "assertive",
            Action = new TestToastAction
            {
                Label = "Retry",
                AltText = "Press Enter to retry the operation",
                OnClick = () => { }
            }
        }, new ToastOptions { Priority = ToastPriority.Assertive });
    }

    private void ShowBackgroundToast()
    {
        Toasts.Add(new TestToastContent
        {
            Title = "Background Toast",
            Description = "This is a polite announcement.",
            Variant = "polite"
        }, new ToastOptions { Priority = ToastPriority.Polite });
    }

    private string GetAnnouncementText(TestToastContent content)
    {
        if (!string.IsNullOrEmpty(content.Title))
        {
            return $"{content.Title}. {content.Description}";
        }
        return content.Description;
    }
}

<style>
    .test-section {
        margin-bottom: 24px;
        padding: 16px;
        border: 1px solid #ccc;
        border-radius: 4px;
    }
    
    .test-section button {
        margin-right: 8px;
        padding: 8px 16px;
        border: 1px solid #ccc;
        background: #f0f0f0;
        cursor: pointer;
    }
    
    .toast-viewport {
        position: fixed;
        bottom: 16px;
        right: 16px;
        display: flex;
        flex-direction: column;
        gap: 8px;
        max-width: 400px;
        margin: 0;
        padding: 0;
        list-style: none;
        z-index: 1000;
    }
    
    [data-summit-toast-root] {
        position: relative;
        padding: 16px;
        background: white;
        border: 1px solid #ccc;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }
    
    [data-summit-toast-title] {
        font-weight: 600;
        margin-bottom: 4px;
    }
    
    [data-summit-toast-close] {
        position: absolute;
        top: 8px;
        right: 8px;
        border: none;
        background: transparent;
        cursor: pointer;
        font-size: 18px;
    }
</style>
