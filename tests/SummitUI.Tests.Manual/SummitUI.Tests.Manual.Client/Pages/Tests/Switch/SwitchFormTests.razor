@page "/tests/switch/form"
@rendermode InteractiveWebAssembly
@using System.ComponentModel.DataAnnotations

@if (!RendererInfo.IsInteractive)
{
    <div data-testid="page-loading">Loading...</div>
}
else
{
<div data-testid="page-ready">
    <h1>Switch Form Tests</h1>
    
    <!-- Form Integration (Hidden Input Tests) -->
    <div class="test-section" data-testid="form-section">
        <h2>Form Submission (Hidden Inputs)</h2>
        <form @onsubmit="HandleSubmit" @onsubmit:preventDefault class="d-flex flex-column gap-3" style="max-width: 300px;">
            <div class="d-flex align-items-center justify-content-between">
                <label for="notifications">Notifications</label>
                <SmSwitchRoot Name="notifications" @bind-Checked="_notifications" id="notifications" class="switch-root" data-testid="notifications-switch">
                    <SmSwitchThumb class="switch-thumb" />
                </SmSwitchRoot>
            </div>
            
            <div class="d-flex align-items-center justify-content-between">
                <label for="marketing">Marketing Emails</label>
                <SmSwitchRoot Name="marketing" Value="yes" @bind-Checked="_marketing" id="marketing" class="switch-root" data-testid="marketing-switch">
                    <SmSwitchThumb class="switch-thumb" />
                </SmSwitchRoot>
            </div>

            <button type="submit" class="btn btn-primary">Submit</button>
        </form>
        
        @if (_lastSubmitData != null)
        {
            <div class="mt-3 alert alert-info">
                <pre>@_lastSubmitData</pre>
            </div>
        }
    </div>
    
    <!-- Required Switch (Hidden Input with Required) -->
    <div class="test-section" data-testid="required-section">
        <h2>Required Switch</h2>
        <form class="d-flex flex-column gap-3" style="max-width: 300px;">
            <div class="d-flex align-items-center justify-content-between">
                <label for="required-switch">Accept Terms</label>
                <SmSwitchRoot Name="terms" Required="true" @bind-Checked="_required" id="required-switch" class="switch-root" data-testid="required-switch">
                    <SmSwitchThumb class="switch-thumb" />
                </SmSwitchRoot>
            </div>
        </form>
    </div>
    
    <!-- EditForm Integration -->
    <div class="test-section" data-testid="editform-section">
        <h2>EditForm Integration (with Validation)</h2>
        <EditForm Model="_model" OnValidSubmit="HandleValidSubmit" FormName="switch-editform">
            <DataAnnotationsValidator />
            
            <div class="form-field">
                <div class="d-flex align-items-center justify-content-between">
                    <label for="editform-notifications">Notifications</label>
                    <SmSwitchRoot @bind-Checked="_model.Notifications" id="editform-notifications" class="switch-root" data-testid="editform-notifications-switch">
                        <SmSwitchThumb class="switch-thumb" />
                    </SmSwitchRoot>
                </div>
            </div>
            
            <div class="form-field">
                <div class="d-flex align-items-center justify-content-between">
                    <label for="editform-marketing">Marketing Emails</label>
                    <SmSwitchRoot @bind-Checked="_model.Marketing" id="editform-marketing" class="switch-root" data-testid="editform-marketing-switch">
                        <SmSwitchThumb class="switch-thumb" />
                    </SmSwitchRoot>
                </div>
            </div>
            
            <div class="form-field">
                <div class="d-flex align-items-center justify-content-between">
                    <label for="editform-terms">Accept Terms (Required)</label>
                    <SmSwitchRoot @bind-Checked="_model.AcceptTerms" id="editform-terms" class="switch-root" data-testid="editform-terms-switch">
                        <SmSwitchThumb class="switch-thumb" />
                    </SmSwitchRoot>
                </div>
                <ValidationMessage For="@(() => _model.AcceptTerms)" class="validation-message" />
            </div>

            <button type="submit" class="btn btn-primary" data-testid="editform-submit-button">Submit EditForm</button>
            
            <ValidationSummary class="validation-summary" />
        </EditForm>
        
        @if (_editFormResult != null)
        {
            <div class="mt-3 alert alert-success" data-testid="editform-result">
                @_editFormResult
            </div>
        }
    </div>
</div>
}

<style>
    .switch-root {
        all: unset;
        display: inline-flex;
        width: 42px;
        height: 25px;
        background-color: #e4e4e7;
        border-radius: 9999px;
        position: relative;
        box-shadow: 0 2px 10px var(--black-a7);
        -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
        cursor: pointer;
    }

    .switch-root:focus-visible {
        box-shadow: 0 0 0 2px black;
    }

    .switch-root[data-state='checked'] {
        background-color: #000;
    }

    .switch-thumb {
        display: block;
        width: 21px;
        height: 21px;
        background-color: white;
        border-radius: 9999px;
        box-shadow: 0 2px 2px var(--black-a7);
        transition: transform 100ms;
        transform: translateX(2px);
        will-change: transform;
        margin-top: 2px;
    }

    .switch-root[data-state='checked'] .switch-thumb {
        transform: translateX(19px);
    }
    
    .test-section {
        margin-bottom: 2rem;
        padding: 1rem;
        border: 1px solid #e0e0e0;
        border-radius: 4px;
    }
    
    .form-field {
        margin-bottom: 1rem;
    }
    
    .validation-message {
        color: #dc3545;
        font-size: 0.875rem;
        margin-top: 0.25rem;
    }
    
    .validation-summary {
        color: #dc3545;
        margin-top: 1rem;
    }
</style>

@code {
    // Standard form fields (with hidden inputs)
    private bool _notifications;
    private bool _marketing;
    private bool _required;
    private string? _lastSubmitData;
    
    // EditForm model
    private FormModel _model = new();
    private string? _editFormResult;

    private void HandleSubmit()
    {
        _lastSubmitData = $"Notifications: {_notifications}, Marketing: {_marketing}";
    }

    private void HandleValidSubmit()
    {
        _editFormResult = $"EditForm submitted! Notifications: {_model.Notifications}, Marketing: {_model.Marketing}, Terms: {_model.AcceptTerms}";
    }

    public class FormModel
    {
        public bool Notifications { get; set; }
        
        public bool Marketing { get; set; }
        
        [Range(typeof(bool), "true", "true", ErrorMessage = "You must accept the terms and conditions.")]
        public bool AcceptTerms { get; set; }
    }
}
